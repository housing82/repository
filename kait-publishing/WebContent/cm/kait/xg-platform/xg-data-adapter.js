(function(){"use strict";!function(a,b){return"function"==typeof define&&define.amd?define("XgDataAdapter",["XgCommon"],b):a.XgDataAdapter=b(a.XgCommon)}(window,function(a){var b,c,d,e,f,g,h,i,j;return i="xg-data-adapter.js",j="XgDataAdapter",XgPlatform.XgLogger.info(function(){return i+" : load start"}),e=function(){var a,b;if(b=null,!window.XMLHttpRequest&&!window.ActiveXObject)return alert("Your browser doesn't support XMLHTTPRequest!!"),null;if(window.XMLHttpRequest)b=new XMLHttpRequest;else try{b=new ActiveXObject("Msxml2.XMLHTTP")}catch(c){a=c,b=new ActiveXObject("Microsoft.XMLHTTP")}return b},f=function(a){var b,c;return b||(b=e()),c=a.URL,c.indexOf("?")>-1?c.length!==c.indexOf("?")+1&&(c+="&"):c+="?",c+="SP-IO="+a.dataType,void 0!==a.SOCD&&null!==a.SOCD&&(c+="&SP-SOCD="+a.SOCD),a.params&&(c+="&SP-PARAM="+encodeURIComponent(a.params)),c+="&_="+(new Date).getTime(),"BIN"===a.dataType&&(b.responseType="arraybuffer"),b.dtIDs=a.dtIDs,b.onreadystatechange=function(){return a.self.onReadyStateChange(b)},b.open("GET",c,a.async),b.setRequestHeader("Content-Type","text/plain"),b.send(),b},g=function(a){var b,c,d,f,g,h,i;if(b||(b=e()),i=a.URL,f=a.headers.length,"BIN"===a.dataType&&(b.responseType="arraybuffer"),b.dtIDs=a.dtIDs,b.onreadystatechange=function(){return a.self.onReadyStateChange(b)},b.open("POST",i,a.async),b.setRequestHeader("SP-IO",a.dataType),b.setRequestHeader("SP-SOCD",a.SOCD),b.setRequestHeader("SP-PARAM",encodeURIComponent(a.params)),f>0)for(c=d=0,h=f-1;h>=0?h>=d:d>=h;c=h>=0?++d:--d)g=a.headers[c],b.setRequestHeader(g.name,g.value);return b.setRequestHeader("Content-Type","text/plain;charset=UTF-8"),b.send(a.packet),b},d=function(b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y;for(K=0,H=0,f=new Uint8Array(b),Y=0,D={},D.columns=[],D.rows=[];H<f.length-1;){if(K+=a.constant.PACKET_SIZE.PS+a.constant.PACKET_SIZE.PD+a.constant.PACKET_SIZE.PV+a.constant.PACKET_SIZE.PT,H+=a.constant.PACKET_SIZE.PS+a.constant.PACKET_SIZE.PD+a.constant.PACKET_SIZE.PV+a.constant.PACKET_SIZE.PT+a.constant.PACKET_SIZE.PI,G=f.subarray(K,H),D.dataID=String.fromCharCode.apply(null,G),K+=a.constant.PACKET_SIZE.PI,H+=a.constant.PACKET_SIZE.PC,I=f.subarray(K,H),s=String.fromCharCode.apply(null,I),K+=a.constant.PACKET_SIZE.PC+a.constant.PACKET_SIZE.PP+a.constant.PACKET_SIZE.PR,H+=a.constant.PACKET_SIZE.PP+a.constant.PACKET_SIZE.PR+a.constant.PACKET_SIZE.PL,J=f.subarray(K,H),n=parseInt(String.fromCharCode.apply(null,J),10),K+=a.constant.PACKET_SIZE.PL,H+=n,F=f.subarray(K,H),"S"===s||"C"===s){o=0,l=0,l+=a.constant.DATASET_SIZE.DSNM,m=F.subarray(o,l),D.datasetName=String.fromCharCode.apply(null,m),o+=a.constant.DATASET_SIZE.DSNM+a.constant.DATASET_SIZE.DSTP+a.constant.DATASET_SIZE.DSCR+a.constant.DATASET_SIZE.DSIU+a.constant.DATASET_SIZE.DSIP,l+=a.constant.DATASET_SIZE.DSTP+a.constant.DATASET_SIZE.DSCR+a.constant.DATASET_SIZE.DSIU+a.constant.DATASET_SIZE.DSIP+a.constant.DATASET_SIZE.DSVM,q=F.subarray(o,l),V=0;for(t in q)V+=parseInt(q[t],10)<<8*(q.length-1-t);o+=a.constant.DATASET_SIZE.DSVM+a.constant.DATASET_SIZE.DSVU+a.constant.DATASET_SIZE.DSRP,l+=a.constant.DATASET_SIZE.DSVU+a.constant.DATASET_SIZE.DSRP+a.constant.DATASET_SIZE.DSRC,r=F.subarray(o,l),T=0;for(t in r)T+=parseInt(r[t],10)<<8*(r.length-1-t);o+=a.constant.DATASET_SIZE.DSRC,l+=a.constant.DATASET_SIZE.DSCC,p=F.subarray(o,l),g=0;for(t in p)g+=parseInt(p[t],10)<<8*(p.length-1-t);if(o+=a.constant.DATASET_SIZE.DSCC+a.constant.DATASET_SIZE.DSCS,l+=a.constant.DATASET_SIZE.DSCS,V&&T&&g){for(t=y=0,N=g-1;N>=0?N>=y:y>=N;t=N>=0?++y:--y){D.columns[t]={},l+=a.constant.COLUMN_SIZE.CNM,h=F.subarray(o,l),D.columns[t].name=decodeURI(escape(String.fromCharCode.apply(null,h))).replace(/\x00/g,""),o+=a.constant.COLUMN_SIZE.CNM+a.constant.COLUMN_SIZE.CVR+a.constant.COLUMN_SIZE.CVS,l+=a.constant.COLUMN_SIZE.CVR+a.constant.COLUMN_SIZE.CVS+a.constant.COLUMN_SIZE.CTP,k=F.subarray(o,l),D.columns[t].type=0;for(w in k)D.columns[t].type+=parseInt(k[w],10)<<8*(k.length-1-w);o+=a.constant.COLUMN_SIZE.CTP,l+=a.constant.COLUMN_SIZE.CPR,i=F.subarray(o,l),D.columns[t].prop=0;for(w in i)D.columns[t].prop+=parseInt(i[w],10)<<8*(i.length-1-w);o+=a.constant.COLUMN_SIZE.CPR,l+=a.constant.COLUMN_SIZE.CSZ,j=F.subarray(o,l),D.columns[t].size=0;for(w in j)D.columns[t].size+=parseInt(j[w],10)<<8*(j.length-1-w);o+=a.constant.COLUMN_SIZE.CSZ+a.constant.COLUMN_SIZE.CDS,l+=a.constant.COLUMN_SIZE.CDS}for(u=[],v=[],t=z=0,O=T-1;O>=0?O>=z:z>=O;t=O>=0?++z:--z){D.rows[Y+t]={},l+=a.constant.ROW_SIZE.RO,W=F.subarray(o,l),u[t]=0;for(w in W)u[t]+=parseInt(W[w],10)<<8*(W.length-1-w);o+=a.constant.ROW_SIZE.RO,l+=a.constant.ROW_SIZE.RS,X=F.subarray(o,l),v[t]=0;for(w in X)v[t]+=parseInt(X[w],10)<<8*(X.length-1-w);o+=a.constant.ROW_SIZE.RS}for(U=F.subarray(o,l+V),t=A=0,P=T-1;P>=0?P>=A:A>=P;t=P>=0?++A:--A){M=0,L=0,S=U.subarray(u[t],u[t]+v[t]),L+=a.constant.ROW_SIZE.RJ,d=S.subarray(M,L),D.rows[Y+t].crudType=0;for(w in d)D.rows[Y+t].crudType+=parseInt(d[w],10)<<8*(d.length-1-w);for(M+=a.constant.ROW_SIZE.RJ,C=[],w=B=0,Q=g-1;Q>=0?Q>=B:B>=Q;w=Q>=0?++B:--B){C[w]=0,L+=a.constant.ROW_SIZE.RF,c=S.subarray(M,L);for(x in c)C[w]+=parseInt(c[x],10)<<8*(c.length-1-x);M+=a.constant.ROW_SIZE.RF}for(C[g]=S.length,D.rows[Y+t].V=[],w=E=0,R=g-1;R>=0?R>=E:E>=R;w=R>=0?++E:--E){if(D.rows[Y+t].V[w]=null,L+=C[w+1]-C[w],e=S.subarray(M,L),1===D.columns[w].type)D.rows[Y+t].V[w]=decodeURI(escape(String.fromCharCode.apply(null,e))).replace(/\x00/g,"");else if(2===D.columns[w].type)for(x in e)D.rows[Y+t].V[w]+=parseInt(e[x],10)<<8*(e.length-1-x);M+=C[w+1]-C[w]}}Y+=t}}K+=n}return D},c=function(){var a,b,c;a="--sunny418&imagodei&comnik&chaser&batman&19981231&한글은?",c="Content-Disposition: form-data:name=",b="\r\n"},b=function(b){return this.xgDataAdapterId=b,this.xgDataAdapterId||(this.xgDataAdapterId=a.createUUID()),this.async=!0,this.src=null,this.socd=null,this.params={},this.dataType=XgPlatform.XgDataType,this.cbTable={},this.requestType="POST",this.processSize=200,this.useFragment=!1,this.requestHeader=[],this},h=b.prototype,h.onReadyStateChange=function(b){var c,e,f,g;if(4===b.readyState)if(g=arguments,XgPlatform.XgLogger.debug(function(){return[j+".setDataAdapter",g]}),f=void 0,"BIN"===this.dataType?(c=b.response,c&&(f=d(c))):f=b.responseText,e=this.cbTable,200===b.status){if("function"!=typeof e.func)throw new a.Error("[onreadystatechange]Response: "+b.responseText,i);e.func(e.id,f,"all"),f=null}else{if("function"!=typeof e.func)throw new a.Error("[onreadystatechange]Error: "+b.statusText,i);e.func(e.id,"[onreadystatechange]Error ["+b.statusText+"]","all")}return this},h.CRUD=function(b,c,d,e,h){var k,l,m;if(l=arguments,XgPlatform.XgLogger.debug(function(){return[j+".CRUD",l]}),c=c.toUpperCase(),this.cbTable={id:d,func:h,type:this.dataType},k=this.cbTable,void 0===b||null===b){if(void 0===this.src||null===this.src)throw new a.Error("Error: Invaild server URL!",i);b=this.src}if("undefined"!=typeof Worker&&this.useFragment===!0&&"R"===c)"undefined"==typeof m&&(m=new Worker(XgPlatform.XgPath+"/xg-data-worker.js")),m.onmessage=function(b){var c;if(200!==b.data.code||"column"!==(c=b.data.step)&&"row"!==c&&"message"!==c){if("function"==typeof k.func)return k.func(k.id,"[onmessage]Error ["+b.data.result+"]",b.data.step);throw new a.Error("[onmessage]Error: "+b.data.result,i)}if("function"==typeof k.func)return k.func(k.id,b.data.result,b.data.step);throw new a.Error("[onmessage]Response: "+b.data.result,i)},m.onerror=function(a){return console.log("worker ERROR: "+a.filename+", "+a.message)},m.postMessage({step:"select",async:this.async,dataType:this.dataType,requestType:this.requestType,dtIDs:d,packet:e,unitSize:this.processSize,params:this.getParams(),headers:this.requestHeader,SOCD:this.socd,URL:b});else if("C"===c||"U"===c||"D"===c)g({self:this,async:this.async,dataType:this.dataType,dtIDs:d,packet:e,params:this.getParams(),headers:this.requestHeader,SOCD:this.socd,URL:b});else{if("R"!==c)throw new a.Error("Invalid CRUD mode.",i);if("GET"===this.requestType)f({self:this,async:this.async,dataType:this.dataType,dtIDs:d,params:this.getParams(),SOCD:this.socd,URL:b});else{if("POST"!==this.requestType)throw new a.Error("Invalid request mode.",this.requestType);g({self:this,async:this.async,dataType:this.dataType,dtIDs:d,packet:e,params:this.getParams(),headers:this.requestHeader,SOCD:this.socd,URL:b})}}return this},h.getDataType=function(){var a;return a=arguments,XgPlatform.XgLogger.debug(function(){return[j+".getDataType",a]}),(void 0===this.dataType||null===this.dataType)&&(this.dataType="JSON",XgPlatform.XgDataType=this.dataType),this.dataType},h.setDataType=function(a){var b,c,d;if(d=arguments,XgPlatform.XgLogger.debug(function(){return[j+".setDataType",d]}),a=a.toUpperCase(),"XML"===a||"JSON"===a||"BIN"===a||"HTML5JSON"===a)if(c=e(),"BIN"===a){try{c.responseType=""}catch(f){b=f,console.log(b.message),a="JSON"}this.dataType=a}else this.dataType=a;else this.dataType="JSON";return XgPlatform.XgDataType=this.dataType,this},h.getParams=function(){var a,b,c,d,e,f,g,h;if(g=arguments,XgPlatform.XgLogger.debug(function(){return[j+".getParams",g]}),d="",void 0!==this.params&&null!==this.params){"undefined"==typeof Array.isArray&&(Array.isArray=function(a){return Object.prototype.toString.call("[object Array]"===a)}),e=this.params;for(b in e)if(h=e[b],Array.isArray(h))for(a=c=0,f=h.length-1;f>=0?f>=c:c>=f;a=f>=0?++c:--c)d+=null===h[a]||void 0===h[a]?","+b+"=":","+b+"="+h[a];else d+=","+b+"="+h}return 0===d.indexOf(",")&&(d=d.substring(1)),d.replace(/%20/g,"+"),d},h.setParams=function(a){var b,c,d,e,f,g,h,i;if(i=arguments,XgPlatform.XgLogger.debug(function(){return[j+".setParams",i]}),a){if("string"==typeof a){for(f={},b=a.split("&"),d=e=0,h=b.length-1;h>=0?h>=e:e>=h;d=h>=0?++e:--e)c=b[d].split("="),f[c[0]]=c[1];a=f}Object.assign?this.params=Object.assign({},this.params,a):(g=function(){var a,b,c,e;if(c={},!arguments.length)return c;for(d=b=0,e=arguments.length-1;e>=0?e>=b:b>=e;d=e>=0?++b:--b)for(a in arguments[d])c[a]=arguments[d][a];return c},this.params=g(this.params,a))}return this},h.resetParams=function(){return XgPlatform.XgLogger.debug(function(){return[j+".resetParams"]}),this.params={},this},h.getSOCD=function(){var a;return a=arguments,XgPlatform.XgLogger.debug(function(){return[j+".getSOCD",a]}),this.socd},h.setSOCD=function(b){var c;if(c=arguments,XgPlatform.XgLogger.debug(function(){return[j+".setSOCD",c]}),!(-1<b.indexOf("=")&&(-1<b.indexOf("O:")||-1<b.indexOf("I:"))))throw new a.Error("Invalid SOCD.",i);return this.socd=b,this.socd.trim(),this},h.getSrc=function(){var a;return a=arguments,XgPlatform.XgLogger.debug(function(){return[j+".getSrc",a]}),this.src},h.setSrc=function(a){var b;return b=arguments,XgPlatform.XgLogger.debug(function(){return[j+".setSrc",b]}),this.src=a,this},h.getAsyncStatus=function(){var a;return a=arguments,XgPlatform.XgLogger.debug(function(){return[j+".getAsyncStatus",a]}),this.async},h.setAsyncStatus=function(a){var b;return b=arguments,XgPlatform.XgLogger.debug(function(){return[j+".setAsyncStatus",b]}),this.async=a,this},h.getUseFragment=function(){var a;return a=arguments,XgPlatform.XgLogger.debug(function(){return[j+".getUseFragment",a]}),this.useFragment},h.setUseFragment=function(a){var b;return b=arguments,XgPlatform.XgLogger.debug(function(){return[j+".setUseFragment",b]}),this.useFragment=a,this},h.getXgPath=function(){var a;return a=arguments,XgPlatform.XgLogger.debug(function(){return[j+".getXgPath",a]}),XgPlatform.XgPath},h.setXgPath=function(a){var b;return b=arguments,XgPlatform.XgLogger.debug(function(){return[j+".setXgPath",b]}),XgPlatform.XgPath=a,this},h.getProcessSize=function(){var a;return a=arguments,XgPlatform.XgLogger.debug(function(){return[j+".getProcessSize",a]}),this.processSize},h.setProcessSize=function(a){var b;return b=arguments,XgPlatform.XgLogger.debug(function(){return[j+".setProcessSize",b]}),this.processSize=a>2e3?2e3:200>a?200:a,this},h.getRequestType=function(){var a;return a=arguments,XgPlatform.XgLogger.debug(function(){return[j+".getRequestType",a]}),this.requestType},h.setRequestType=function(a){var b;return a=a.toUpperCase(),b=arguments,XgPlatform.XgLogger.debug(function(){return[j+".setRequestType",b]}),("GET"===a||"POST"===a)&&(this.requestType=a),this},h.addRequestHeader=function(a,b){var c,d;return d=arguments,XgPlatform.XgLogger.debug(function(){return[j+".addRequestHeader",d]}),c={},c.name=a,c.value=b,this.requestHeader.push(c),c=null,this},XgPlatform.XgLogger.info(function(){return i+" : load end"}),b})}).call(this);