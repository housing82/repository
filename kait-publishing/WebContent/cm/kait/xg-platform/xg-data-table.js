(function(){"use strict";var a=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};!function(a,b){return"function"==typeof define&&define.amd?define("XgDataTable",["XgCommon"],b):a.XgDataTable=b(a.XgCommon)}(window,function(b){var c,d,e,f,g,h,i,j,k,l;return l="xg-data-table.js",XgPlatform.XgLogger.info(function(){return l+" : load start"}),c=function(a,c){var d;return this.id=a,this.id||(this.id=b.createUUID()),this.header=[],this.body=[],this.rowPos=-1,this.parent=void 0,this.uiAdapter=void 0,this.booleanColumn={},this.url={},this.bindedComponents={},this.preventXSS=!1,this.source=null,this.overrideColumn=!1,c?(c.preventXSS===!0&&(this.preventXSS=!0),c.booleanColumn&&c.booleanColumn instanceof Array&&this.setBooleanColumn(c.booleanColumn),((d=c.overrideColumn)===!0||d===!1)&&this.useOverrideColumn(c.overrideColumn),c.url instanceof Object&&Object.keys(c.url)&&this.setUrl(c.url),this):this},k=c.prototype,g=function(a){return"string"!=typeof a||isNaN(a)||(a=parseInt(a,10)),"number"!=typeof a&&(a=null),a},h=function(a,c){if(null===a)return a;if(void 0===a||!c)throw new b.Error("Can not convert value, type",l);return"int"===c||"long"===c||"bigint"===c?a=parseInt(a,10):"decimal"===c?a=parseFloat(a):"bool"===c?a=Boolean(a):a.toString(),a},e=function(a,c,d){var e,f,g;if(void 0===(f=[a[c],a[d]])||null===f)throw new b.Error('Can not find propery "'+c+'" or "'+d+'" in obj',l);return a[c]>a[d]&&(g=a[c],e=a[d],a[c]=g,console.warn("EndRowIdx is bigger then startRowIdx. Parameter index sequence will be change")),a},j=function(a){return b.getKeyByValue(b.constant.DATATYPE,a)},i=function(a){return b.getKeyByValue(b.constant.DATATYPE_GAUCE,a)},f=function(a,c){if(void 0===a||null===a)throw new b.Error("idx is required",l);if(c instanceof Array){if("number"!=typeof a)throw new b.Error("idx param is not number",l);if(!(c instanceof Array))throw new b.Error("array param is not instance of Array",l);if(0>a||a>c.length)throw new b.Error("idx is out of boundary",l)}else if(!c[a])throw new b.Error("[idx="+a+"] is not exist",l)},d=function(a,b,c,d,e,f){return e=g(e),f||(f="normal"),a.header.push(new Array(a.getColumnCount(),b,c,d,e,f)),a},k.getUrl=function(a){var b;return b=arguments,XgPlatform.XgLogger.debug(function(){return["XgDataTable.getUrl",b]}),a?this.url[a]:this.url},k.setUrl=function(){var a;return a=arguments,XgPlatform.XgLogger.debug(function(){return["XgDataTable.setUrl",a]}),2===arguments.length&&"string"==typeof arguments[0]&&(this.url[arguments[0]]=arguments[1]),1===arguments.length&&arguments[0]instanceof Object&&(this.url=arguments[0]),this},k.getId=function(){var a;return a=arguments,XgPlatform.XgLogger.debug(function(){return["XgDataTable.getId",a]}),this.id},k.clearData=function(){var a,b,c,d;return d=arguments,XgPlatform.XgLogger.debug(function(){return["XgDataTable.clearData",d]}),this.body.length=0,this.rowPos=-1,null!=(null!=(a=this.source)?a.localdata:void 0)&&(this.source.localdata.length=0),null!=(null!=(b=this.uiAdapter)?b.cachedrecords:void 0)&&(this.uiAdapter.cachedrecords.length=0),null!=(null!=(c=this.uiAdapter)?c.records:void 0)&&(this.uiAdapter.records.length=0),this.uiAdapter=null,this},k.resetDataTable=function(){var a;return a=arguments,XgPlatform.XgLogger.debug(function(){return["XgDataTable.resetDataTable",a]}),this.header.length=0,this.clearData()},k.addColumn=function(a,c,e,f){var g,h;if(g=arguments,XgPlatform.XgLogger.debug(function(){return["XgDataTable.addColumn",g]}),!(a&&c&&e))throw new b.Error("name, type, size are required",l);if(h="string","number"==typeof c&&(c=j(c)),"string"!=typeof c)throw new b.Error('typeof "type" is not "number" or "string"',l);return("int8"===c||"int16"===c||"int32"===c||"uint8"===c||"uint16"===c||"uint32"===c)&&(h="int"),("int64"===c||"uint64"===c)&&(h="bigint"),"double"===c&&(h="decimal"),"unknown"===c&&(h="blob"),d(this,a,c,h,e,f)},k.addColumnForGauce=function(a,c,e,f){var g,h;if(g=arguments,XgPlatform.XgLogger.debug(function(){return["XgDataTable.addColumnForGauce",g]}),!(a&&c&&e))throw new b.Error("name, typeOfGauce, size are required",l);if(h="string","number"==typeof c&&(c=i(c)),"string"!=typeof c)throw new b.Error('typeof "typeOfGauce" is not "number" or "string"',l);return("int"===c||"long"===c)&&(h="int32"),"bigint"===c&&(h="int64"),"decimal"===c&&(h="double"),"blob"===c&&(h="unknown"),d(this,a,h,c,e,f)},k.addRow=function(a,c){var d,e,f,g,h,i,j,k;if(j=arguments,XgPlatform.XgLogger.debug(function(){return["XgDataTable.addRow",j]}),a[-1]&&delete a[-1],d=this.getColumnCount(),0===d)throw new b.Error("DataTable header is empty. Can not add row.",l);if(a&&!(a instanceof Array))throw new b.Error("rowData must be array",l);if(a&&a.length)for(a[0]instanceof Array||(a=[a],a[0].status=b.constant.STATUS.INSERT),f=g=0,h=a.length;h>g;f=++g){if(i=a[f],i.length!==d)throw new b.Error("rowData size is not equal to columnCount",l);if(k=b.constant.STATUS.INSERT,c&&(k=b.constant.STATUS.NORMAL),a[f].status=k,this.preventXSS)for(e=a[f].length;e--;)a[f][e]=b.filterXSS(a[f][e])}return a||(a=[new Array(d)],a[0].status=b.constant.STATUS.INSERT),this.body=this.body.concat(a),this},k.insertRow=function(a,c){var d,e,f,h;if(f=arguments,XgPlatform.XgLogger.debug(function(){return["XgDataTable.insertRow",f]}),d=this.getColumnCount(),a=g(a),0===d)throw new b.Error("DataTable header is empty. Can not insert row.",l);if(c&&!(c instanceof Array))throw new b.Error("rowData must be array",l);if(c&&c.length!==d)throw new b.Error("rowData size is not equal to columnCount",l);return c||(c=new Array(d)),h=b.constant.STATUS.INSERT,e=this.getRowCount(),a>e&&(a=e,console.warn("rowIdx is bigger then rowCount. rowIdx set to lastIdx")),0>a&&(a=0,console.warn("rowIdx is smaller then 0. rowIdx set to 0")),c||(c=new Array(d)),c.status=h,this.body.splice(a,0,c),this},k.deleteRow=function(a){var c,d,e;return d=arguments,XgPlatform.XgLogger.debug(function(){return["XgDataTable.deleteRow",d]}),c=this.getRow(a),e=c.status,e===b.constant.STATUS.DELETE?(console.warn("Row already deleted."),this):(this.setRowStatus(a,b.constant.STATUS.DELETE),this)},k.getValue=function(a,b){var c,d;return d=arguments,XgPlatform.XgLogger.debug(function(){return["XgDataTable.getValue",d]}),c=-1,"string"==typeof b&&(c=this.getColumnIndex(b)),"number"==typeof b&&(c=b),this.body[a][c]},k.setValue=function(a,c,d){var e,f,g,i;if(g=arguments,XgPlatform.XgLogger.debug(function(){return["XgDataTable.setValue",g]}),-1===c)return this;if(e=-1,void 0===d)throw new b.Error("Value is required",l);if("string"==typeof c&&(e=this.getColumnIndex(c)),"number"==typeof c&&(e=c),i=this.getRowStatus(a),i===b.constant.STATUS.DELETE)console.warn("Row already deleted.");else{if(d=h(d,this.header[e][b.constant.COLUMN.TYPE_OF_GAUCE]),f=this.body[a][e],f===d)return this;this.preventXSS&&(d=b.filterXSS(d)),this.body[a][e]=d,i!==b.constant.STATUS.INSERT&&this.setRowStatus(a,b.constant.STATUS.UPDATE)}return this},k.getValueSize=function(a,b){var c,d;return c=arguments,XgPlatform.XgLogger.debug(function(){return["XgDataTable.setValue",c]}),d=this.getValue(a,b),d.length||(d=d.toString()),d.length},k.getRowStatus=function(a){var b;return b=arguments,XgPlatform.XgLogger.debug(function(){return["XgDataTable.getRowStatus",b]}),this.body[a].status},k.getRowStatusCode=function(a){var c,d;return d=arguments,XgPlatform.XgLogger.debug(function(){return["XgDataTable.getRowStatusCode",d]}),c=b.getKeyByValue(b.constant.STATUS,a),c="UNKNOWN"===c?"UN":c.substr(0,1),"I"===c&&(c="C"),c},k.setRowStatus=function(a,c){var d;return d=arguments,XgPlatform.XgLogger.debug(function(){return["XgDataTable.setRowStatus",d]}),b.getKeyByValue(b.constant.STATUS,c),this.body[a].status=c,this},k.clearRowStatus=function(a){var c;return c=arguments,XgPlatform.XgLogger.debug(function(){return["XgDataTable.clearRowStatus",c]}),this.setRowStatus(a,b.constant.STATUS.NORMAL)},k.getColumnCount=function(){var a;return a=arguments,XgPlatform.XgLogger.debug(function(){return["XgDataTable.getColumnCount",a]}),this.header.length},k.getColumnIndex=function(a){var c,d,e,f,g,h,i;if(i=arguments,XgPlatform.XgLogger.debug(function(){return["XgDataTable.getColumnIndex",i]}),h=-1,"*xgRowStatus"===a)return h;for(g=this.header,d=e=0,f=g.length;f>e;d=++e)if(c=g[d],c[b.constant.COLUMN.NAME]===a){h=c[b.constant.COLUMN.INDEX];break}return h},k.getColumnName=function(a){var c;return c=arguments,XgPlatform.XgLogger.debug(function(){return["XgDataTable.getColumnName",c]}),this.header[a][b.constant.COLUMN.NAME]},k.getColumnTypeStr=function(a){var c;return c=arguments,XgPlatform.XgLogger.debug(function(){return["XgDataTable.getColumnTypeStr",c]}),this.header[a][b.constant.COLUMN.TYPE]},k.getColumnType=function(a){var c;return c=arguments,XgPlatform.XgLogger.debug(function(){return["XgDataTable.getColumnType",c]}),b.constant.DATATYPE[this.getColumnTypeStr(a)]},k.getColumnTypeStrForGauce=function(a){var c;return c=arguments,XgPlatform.XgLogger.debug(function(){return["XgDataTable.getColumnTypeStrForGauce",c]}),this.header[a][b.constant.COLUMN.TYPE_OF_GAUCE]},k.getColumnTypeForGauce=function(a){var c;return c=arguments,XgPlatform.XgLogger.debug(function(){return["XgDataTable.getColumnTypeForGauce",c]}),b.constant.DATATYPE_GAUCE[this.getColumnTypeStrForGauce(a)]},k.getColumnSize=function(a){var c;return c=arguments,XgPlatform.XgLogger.debug(function(){return["XgDataTable.getColumnSize",c]}),this.header[a][b.constant.COLUMN.SIZE]},k.getColumnConstraint=function(a){var c;return c=arguments,XgPlatform.XgLogger.debug(function(){return["XgDataTable.getColumnConstraint",c]}),this.header[a][b.constant.COLUMN.CONSTRAINT]},k.getRow=function(a){var b;return b=arguments,XgPlatform.XgLogger.debug(function(){return["XgDataTable.getRow",b]}),this.body[a]},k.getRowCount=function(){var a;return a=arguments,XgPlatform.XgLogger.debug(function(){return["XgDataTable.getRowCount",a]}),this.body.length},k.getRowPos=function(){var a;return a=arguments,XgPlatform.XgLogger.debug(function(){return["XgDataTable.getRowPos",a]}),this.rowPos},k.setRowPos=function(a){var c,d;if(d=arguments,XgPlatform.XgLogger.debug(function(){return["XgDataTable.setRowPos",d]}),c=this.getRowCount()-1,0>c)throw new b.Error("Row data is not exist",l);return a=g(a),0>a&&(a=0,console.warn("rowIdx is smaller then 0. rowIdx set to 0")),a>c&&(a=c,console.warn("rowIdx is bigger then rowCount. rowIdx set to lastIdx")),this.rowPos=a,this},k.find=function(c,d,e){var f,g,h,i,j,k;if(k=arguments,XgPlatform.XgLogger.debug(function(){return["XgDataTable.find",k]}),!d)throw new b.Error("Value is required",l);for(e||(e=0,console.warn("StartRowIdx is undefined. StartRowIdx set to 0")),f=g=h=e,i=this.getRowCount()-1;i>=h?i>=g:g>=i;f=i>=h?++g:--g)if(d instanceof Array){if(j=this.body[f][c],a.call(d,j)>=0)return f}else if(this.body[f][c]===d)return f;return-1},k.findAll=function(c,d,e){var f,g,h,i,j,k,m;if(m=arguments,XgPlatform.XgLogger.debug(function(){return["XgDataTable.findAll",m]}),!d)throw new b.Error("Value is required",l);for(e||(e=0,console.warn("StartRowIdx is undefined. StartRowIdx set to 0")),f=[],g=h=i=e,j=this.getRowCount()-1;j>=i?j>=h:h>=j;g=j>=i?++h:--h)d instanceof Array?(k=this.body[g][c],a.call(d,k)>=0&&f.push(g)):this.body[g][c]===d&&f.push(g);return f},k.setBooleanColumn=function(a){var b,c,d,e,f;for(f=arguments,XgPlatform.XgLogger.debug(function(){return["XgDataTable.setBooleanColumn",f]}),b=c=0,d=a.length;d>c;b=++c)e=a[b],this.booleanColumn[e.column]=a[b];return this},k.useOverrideColumn=function(a){var c;if(c=arguments,XgPlatform.XgLogger.debug(function(){return["XgDataTable.useOverrideColumn",c]}),0===arguments.length)return this.overrideColumn;if("boolean"!=typeof a)throw new b.Error("Parameter will be boolean type",l);return this.overrideColumn=a,this},XgPlatform.XgLogger.info(function(){return l+" : load end"}),c})}).call(this);