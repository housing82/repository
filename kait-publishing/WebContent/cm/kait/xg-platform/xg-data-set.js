(function(){"use strict";var a=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1},b={}.hasOwnProperty;!function(a,b){return"function"==typeof define&&define.amd?define("XgDataSet",["jquery","XgCommon","XgDataTable","XgDataAdapter","json3"],b):a.XgDataSet=b(a.jQuery,a.XgCommon,a.XgDataTable,a.XgDataAdapter,a.JSON)}(window,function(c,d,e,f,g){var h,i,j,k,l,m,n,o,p,q,r,s,t,u;return u="xg-data-set.js",XgPlatform.XgLogger.info(function(){return u+" : load start"}),t=this,s=["data-xg-grid","data-xg-chart"],j=function(a,b){var c,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q;r=void 0;try{for(r=document.implementation.createDocument("http://www.shift.co.kr/xmlns/shiftProtocol","sp:envelope",null),w=F=0,B=b.length;B>F;w=++F){for(x=b[w],c=a.getDataTable(b[w]),h=Object.keys(c.booleanColumn),q=r.createElement("sp:datatable"),q.setAttribute("name",c.getId()),r.documentElement.appendChild(q),v=r.createElement("sp:header"),q.appendChild(v),K=c.header,z=H=0,C=K.length;C>H;z=++H)t=K[z],l=c.header[z],p=r.createElement("sp:column"),p.setAttribute("name",l[d.constant.COLUMN.NAME]),p.setAttribute("type",l[d.constant.COLUMN.TYPE_OF_GAUCE]),p.setAttribute("size",l[d.constant.COLUMN.SIZE]),p.setAttribute("constraint",l[d.constant.COLUMN.CONSTRAINT]),v.appendChild(p);for(f=r.createElement("sp:body"),f.setAttribute("use","I"),q.appendChild(f),L=c.body,y=I=0,D=L.length;D>I;y=++I)if(P=L[y],e=c.body[y],(M=e.status)===d.constant.STATUS.INSERT||M===d.constant.STATUS.UPDATE||M===d.constant.STATUS.DELETE)for(O=r.createElement("sp:row"),O.setAttribute("crud",c.getRowStatusCode(e.status)),f.appendChild(O),N=c.header,A=J=0,E=N.length;E>J;A=++J)m=N[A],l=c.header[A],k=c.getValue(y,A),n=l[d.constant.COLUMN.NAME],o=l[d.constant.COLUMN.TYPE_OF_GAUCE],j=r.createElement(n),"int"!==o&&"long"!==o&&"decimal"!==o&&"bigint"!==o||k||(k=0),void 0===k||null===k?(j.setAttribute("isNull","true"),k=""):h.length&&c.booleanColumn[n]&&(g=c.booleanColumn[n],k=k?g.trueValue:g.falseValue),"string"!==o&&"url"!==o&&"blob"!==o&&"char"!==o||""===k?("date"===o&&""!==k&&("object"==typeof k?k=d.getGauceDateStr(k):"string"==typeof k&&8!==k.length&&(k=k.replace(/(\s*)/g,""),k=k.replace(/-/gi,""),k=k.replace(/:/gi,""))),Q=r.createTextNode(k),j.appendChild(Q)):(i=r.createCDATASection(k),j.appendChild(i)),O.appendChild(j)}return G=r.createElement("sp:messages"),G.setAttribute("issuccess","true"),r.documentElement.appendChild(G),r}catch(R){throw s=R,new d.Error("XML make fail",u)}finally{r=null}},i=function(b,c,e){var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C;for(e=e||!1,o={envelope:{datatable:[],messages:{"@issuccess":!0,message:[]}}},t=0,p=c.length;p>t;t++){for(n=c[t],l=[],m=b.getDataTable(n),g=Object.keys(m.booleanColumn),f={"@name":n,header:{column:[]},body:{"@use":"I",row:[]}},e&&(delete f["@name"],f.body["@use"]="O"),y=m.header,j=u=0,q=y.length;q>u;j=++u)i=y[j],k=i[d.constant.COLUMN.NAME],w={"@name":k,"@type":i[d.constant.COLUMN.TYPE_OF_GAUCE],"@size":i[d.constant.COLUMN.SIZE].toString(),"@constraint":i[d.constant.COLUMN.CONSTRAINT]},f.header.column.push(w),l.push(k);for(z=m.body,B=v=0,r=z.length;r>v;B=++v){if(A=z[B],C=A.status,w={},!e){if(C!==d.constant.STATUS.INSERT&&C!==d.constant.STATUS.UPDATE&&C!==d.constant.STATUS.DELETE)continue;w={"@crud":m.getRowStatusCode(C)}}for(j=x=0,s=l.length;s>x;j=++x)k=l[j],h=m.getValue(B,j),e||(null===h||void 0===h)&&(h={"@isnull":"true"}),g.length&&a.call(g,k)>=0&&(h=h?m.booleanColumn[k].trueValue:m.booleanColumn[k].falseValue),"date"===f.header.column[j]["@type"]&&""!==h&&("object"==typeof h?h=d.getGauceDateStr(h):"string"==typeof h&&8!==h.length&&(h=h.replace(/(\s*)/g,""),h=h.replace(/-/gi,""),h=h.replace(/:/gi,""))),w[k]=h;f.body.row.push(w)}e?o=f:o.envelope.datatable.push(f)}return o},k=function(b,c,e){var f,g,h,i,j,k,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B;for(p=c.length,g=d.constant.DATATYPE_GAUCE,f=d.constant.CONSTRAINT_NUM;p--;){for(o=b.getDataTable(c[p]),h=o.booleanColumn,i=Object.keys(h),o.resetDataTable(),w=e.columns,k=t=0,q=w.length;q>t;k=++t)j=w[k],o.addColumnForGauce(j.name,d.getKeyByValue(g,j.type),j.size,d.getKeyByValue(f,j.prop).toLowerCase()),x=j.name,a.call(i,x)>=0&&booleanKeyIndexes.push({key:j.name,idx:k});for(y=e.rows,B=u=0,r=y.length;r>u;B=++u){for(A=y[B],z=o.header,k=v=0,s=z.length;s>v;k=++v)j=z[k],n=l(j[d.constant.COLUMN.TYPE_OF_GAUCE],A.V[k]),m=j[d.constant.COLUMN.NAME],i.length&&a.call(i,m)>=0&&(n=n===h[m].trueValue?!0:!1),A.V[k]=n;o.addRow(A.V),o.clearRowStatus(B)}o.changeCount=0}return b},q=function(b,c,e){var f,g,h,i,j,k,m,n,o,p,q,r,s,t,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V;if(e=d.stringToXML(e),N=e.childNodes[0],V="textContent",N.xml&&(V="text",N=e.getElementsByTagName("sp:envelope").item(0)),!N||"sp:envelope"!==N.nodeName||"http://www.shift.co.kr/xmlns/shiftProtocol"!==N.getAttribute("xmlns:sp"))throw new d.Error('Can not parse xml. Only can parse type of "http://www.shift.co.kr/xmlns/shiftProtocol"',u);for(M={},G=N.childNodes,y=0,q=G.length;q>y;y++)if(B=G[y],"sp:datatable"===B.nodeName){if(p=B.getAttribute("name"),!b.isExistDataTable(p)&&!b.useXgServer)for(z=0,r=c.length;r>z;z++)if(T=c[z],b.isExistDataTable(T)){p=T;break}if(!p)continue;for(o=b.getDataTable(p),f=Object.keys(o.booleanColumn),o.useOverrideColumn()?o.clearData():o.resetDataTable(),H=B.childNodes,C=0,s=H.length;s>C;C++){if(g=H[C],"sp:header"===g.nodeName&&!o.useOverrideColumn())for(I=g.childNodes,j=D=0,t=I.length;t>D;j=++D)i=I[j],A=i.getAttribute("name"),U=i.getAttribute("type"),S=i.getAttribute("size"),m=i.getAttribute("constraint"),o.addColumnForGauce(A,U,S,m);if("sp:body"===g.nodeName)for(J=g.childNodes,Q=E=0,v=J.length;v>E;Q=++E){for(O=J[Q],P=[],K=o.header,j=F=0,w=K.length;w>F;j=++F)i=K[j],k=i[d.constant.COLUMN.NAME],h=O.getElementsByTagName(k),n=null,h.length&&(n=l(i[d.constant.COLUMN.TYPE_OF_GAUCE],h[0][V])),f.length&&a.call(f,k)>=0&&(n=n===o.booleanColumn[k].trueValue?!0:!1),P.push(n);o.addRow(P),o.clearRowStatus(Q)}}o.changeCount=0}else if("sp:messages"===B.nodeName){if(!B.getAttribute("issuccess"))throw new d.Error("Fail to receive xml data",u);for(M.result=B.getAttribute(!1)?!0:!1,M.errorMsg=null,M.messages={},L=B.childNodes,R=0,x=L.length;x>R;R++)g=L[R],"sp:message"===g.nodeName&&("INTERNAL"===g.getAttribute("type")?M.errorMsg=g.textContent:"UserMsg"===g.getAttribute("type")&&(M.messages[g.getAttribute("code")]=g.textContent))}return M},p=function(b,c,e,f){var g,h,i,j,k,m,n,o,p,q,r,s,t,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R;if("row"!==f||e){for(I={},y=0,s=c.length;s>y;y++)if(q=c[y],b.useXgServer||b.isExistDataTable(q))switch(p=b.getDataTable(q),e=e.replace(/sp:/gi,""),e="<root>"+e+"</root>",R=d.stringToXML(e),J=R.childNodes[0],f){case"column":if(p.useOverrideColumn())p.clearData();else for(p.resetDataTable(),E=J.childNodes,z=0,t=E.length;t>z;z++)h=E[z],A=h.getAttribute("name"),Q=h.getAttribute("type"),P=h.getAttribute("size"),n=h.getAttribute("constraint"),p.addColumnForGauce(A,Q,P,n);XgPlatform.XgLogger.info(function(){return"[ id : "+p.getId()+" ] init"}),b.$eventEmitter.trigger("xg-bind-event",{uuid:void 0,eventName:"xgDataTableInit",rowIdx:-1,xgDataTableId:p.getId()});break;case"row":for(g=Object.keys(p.booleanColumn),O=[],r=[],F=J.childNodes,N=B=0,v=F.length;v>B;N=++B){for(K=F[N],L=[],M={"*xgRowStatus":d.constant.STATUS.NORMAL,"*xgSequence":-1},G=p.header,k=C=0,w=G.length;w>C;k=++C)j=G[k],m=j[d.constant.COLUMN.NAME],i=K.getElementsByTagName(m),o=null,i.length&&(o=l(j[d.constant.COLUMN.TYPE_OF_GAUCE],i[0].textContent)),g.length&&a.call(g,m)>=0&&(o=o===p.booleanColumn[m].trueValue?!0:!1),L.push(o),M[m]=o;O.push(L),r.push(M)}b.$eventEmitter.trigger("xg-bind-event",{uuid:q,eventName:"addRow",rowIdx:p.getRowCount(),rowValue:O,value:r,xgDataTableId:p.getId(),firstRowYn:!0});break;case"message":if(!J.childNodes[0].getAttribute("issuccess"))throw new d.Error("Fail to receive xml data",u);for(I.result=J.childNodes[0].getAttribute(!1)?!0:!1,I.errorMsg=null,I.messages={},H=J.childNodes,D=0,x=H.length;x>D;D++)h=H[D],"sp:message"===h.nodeName&&("INTERNAL"===h.getAttribute("type")?I.errorMsg=h.textContent:"UserMsg"===h.getAttribute("type")&&(I.messages[h.getAttribute("code")]=h.textContent));p.changeCount=0,XgPlatform.XgLogger.info(function(){return"[ id : "+p.getId()+" ] first row end"}),b.$eventEmitter.trigger("xg-bind-event",{uuid:q,eventName:"firstRowEnd",rowIdx:-1,xgDataTableId:p.getId(),firstRowYn:!0})}return null!==I.result&&void 0!==I.result?I:null}},o=function(b,c,e,f){var h,i,j,k,m,n,o,p,q,r,s,t,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M;if("row"!==f||e){for(G={},p=g.parse(e),v=0,q=c.length;q>v;v++)if(m=c[v],b.useXgServer||b.isExistDataTable(m))switch(k=b.getDataTable(m),f){case"column":if(k.useOverrideColumn())k.clearData();else for(k.resetDataTable(),C=p.column,x=0,r=C.length;r>x;x++)i=C[x],k.addColumnForGauce(i["@name"],i["@type"],i["@size"],i["@constraint"]);XgPlatform.XgLogger.info(function(){return"[ id : "+k.getId()+" ] init"}),b.$eventEmitter.trigger("xg-bind-event",{uuid:void 0,eventName:"xgDataTableInit",rowIdx:-1,xgDataTableId:k.getId()});break;case"row":for(h=Object.keys(k.booleanColumn),L=[],n=[],D=p.row,K=z=0,s=D.length;s>z;K=++z){for(H=D[K],I=[],J={"*xgRowStatus":d.constant.STATUS.NORMAL,"*xgSequence":-1},E=k.header,A=0,t=E.length;t>A;A++)i=E[A],M=d.constant.COLUMN.TYPE_OF_GAUCE,j=i[d.constant.COLUMN.NAME],y=null,void 0!==H[j]&&(y=l(i[M],H[j]),null!==y&&void 0!==y&&"object"==typeof y&&"true"===y["@isnull"]&&(y=null)),h.length&&a.call(h,j)>=0&&(y=y===k.booleanColumn[j].trueValue?!0:!1),I.push(y),J[j]=y;L.push(I),n.push(J)}b.$eventEmitter.trigger("xg-bind-event",{uuid:m,eventName:"addRow",rowIdx:k.getRowCount(),rowValue:L,value:n,xgDataTableId:k.getId(),firstRowYn:!0});break;case"message":if(!p.messages["@issuccess"])throw new d.Error("Fail to receive json data",u);if(G.result="true"===p.messages["@issuccess"]?!0:!1,w=p.messages.message,G.errorMsg=null,G.messages={},w&&w.length)for("totalrecords"===w[0]["@code"]&&(b.totalRecords[m]=w[0]["#text"]),o=B=0,F=w.length-1;F>=0?F>=B:B>=F;o=F>=0?++B:--B)"INTERNAL"===w[o]["@type"]?G.errorMsg=w[o]["#text"]:"UserMsg"===w[o]["@type"]&&(G.messages[w[o]["@code"]]=w[o]["#text"]);k.changeCount=0,XgPlatform.XgLogger.info(function(){return"[ id : "+k.getId()+" ] first row end"}),b.$eventEmitter.trigger("xg-bind-event",{uuid:m,eventName:"firstRowEnd",rowIdx:-1,xgDataTableId:k.getId(),firstRowYn:!0})}return null!==G.result&&void 0!==G.result?G:null}},m=function(b,c,e){var f,h,i,j,k,m,n,o,p,q,r,s,t,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N;if(q=g.parse(e),!q.envelope.messages["@issuccess"])throw new d.Error("Fail to receive json data",u);if(J={},J.result="true"===q.envelope.messages["@issuccess"]?!0:!1,y=q.envelope.messages.message,J.errorMsg=null,J.messages={},y&&y.length)for(p=x=0,F=y.length-1;F>=0?F>=x:x>=F;p=F>=0?++x:--x)"INTERNAL"===y[p]["@type"]?J.errorMsg=y[p]["#text"]:"UserMsg"===y[p]["@type"]&&(J.messages[y[p]["@code"]]=y[p]["#text"]);for(o=q.envelope.datatable,z=0,r=o.length;r>z;z++){if(f=o[z],n=f["@name"],!b.isExistDataTable(n)&&!b.useXgServer)for(B=0,s=c.length;s>B;B++)if(N=c[B],b.isExistDataTable(N)){n=N;break}if(n){if(m=b.getDataTable(n),h=Object.keys(m.booleanColumn),m.useOverrideColumn())m.clearData();else for(m.resetDataTable(),G=f.header.column,C=0,t=G.length;t>C;C++)i=G[C],m.addColumnForGauce(i["@name"],i["@type"],i["@size"],i["@constraint"]);for(H=f.body.row,M=D=0,v=H.length;v>D;M=++D){for(K=H[M],L=[],I=m.header,j=E=0,w=I.length;w>E;j=++E)i=I[j],k=i[d.constant.COLUMN.NAME],A=null,void 0!==K[k]&&(A=l(i[d.constant.COLUMN.TYPE_OF_GAUCE],K[k]),null!==A&&void 0!==A&&"object"==typeof A&&"true"===A["@isnull"]&&(A=null)),h.length&&a.call(h,k)>=0&&(A=A===m.booleanColumn[k].trueValue?!0:!1),L.push(A);m.addRow(L),m.clearRowStatus(M)}m.changeCount=0,y&&y.length&&"totalrecords"===y[0]["@code"]&&(b.totalRecords[n]=y[0]["#text"])}}return J},n=function(a,b,c){var e,f,h,i,j,k,l,m,n,o,p,q,r,s,t,v,w,x,y;if(f=a.getDataAdapter(),w=f.getDataType(),t={},"XML"===w){if(y=d.stringToXML(c),v=y.childNodes[0],x="textContent",v.xml&&(x="text",v=y.getElementsByTagName("sp:envelope").item(0)),!v||"sp:envelope"!==v.nodeName||"http://www.shift.co.kr/xmlns/shiftProtocol"!==v.getAttribute("xmlns:sp"))throw new d.Error('Can not parse xml. Only can parse type of "http://www.shift.co.kr/xmlns/shiftProtocol"',u);for(q=v.childNodes,l=0,j=q.length;j>l;l++)if(o=q[l],"sp:messages"===o.nodeName){if(!o.getAttribute("issuccess"))throw new d.Error("Fail to receive xml data",u);for(t.result=o.getAttribute(!1)?!0:!1,t.errorMsg=null,t.messages={},r=o.childNodes,n=0,k=r.length;k>n;n++)e=r[n],"sp:message"===e.nodeName&&("INTERNAL"===e.getAttribute("type")?t.errorMsg=e.textContent:"UserMsg"===e.getAttribute("type")&&(t.messages[e.getAttribute("code")]=e.textContent))}}else if("JSON"===w){if(i=g.parse(c),!i.envelope.messages["@issuccess"])throw new d.Error("Fail to receive json data",u);if(t.result="true"===i.envelope.messages["@issuccess"]?!0:!1,m=i.envelope.messages.message,t.errorMsg=null,t.messages={},m&&m.length)for(h=p=0,s=m.length-1;s>=0?s>=p:p>=s;h=s>=0?++p:--p)"INTERNAL"===m[h]["@type"]?t.errorMsg=m[h]["#text"]:"UserMsg"===m[h]["@type"]&&(t.messages[m[h]["@code"]]=m[h]["#text"])}return t},l=function(a,b){var c;return c=b,("int"===a||"bigint"===a||"long"===a)&&(c=parseInt(b,10)),"decimal"===a&&(c=parseFloat(b)),"int"!==a&&"bigint"!==a&&"long"!==a&&"decimal"!==a||!isNaN(c)||(c=null),("date"===a||"datetime"===a)&&(c=d.getDateStrFromGauceDate(b)),c},h=function(a,f,g){var h;return this.id=a,this.id||(this.id=d.createUUID()),d.setDataSet(this),this.dataTables={},this.dataAdapter={},this.useXgServer=!1,this.$eventEmitter=c("<div></div>"),this.totalRecords={},h=function(a){return a.$eventEmitter.on("xg-bind-event",function(c,d){var e,f,g,h,i,j,k,l;if(e=a.getDataTable(d.xgDataTableId),"setRowPos"===d.eventName&&e[d.eventName](d.value),"setRowPos"!==(i=d.eventName)&&"xgDataTableInit"!==i){if(l=e.getRowPos(),d.rowIdx<0)return!1;if("setValue"===d.eventName&&"column"===d.bind.type)e[d.eventName](d.rowIdx,d.bind.columnIndex,d.value);else if("addRow"===d.eventName)e[d.eventName](d.rowValue,d.firstRowYn);else if("deleteRow"===d.eventName)for(j=d.value,h=0,g=j.length;g>h;h++)k=j[h],l===k&&(d.rowIdx=k),k=parseInt(k.toString(),10),e[d.eventName](k)}return(f=function(a,c){var e,f,g,h,i,j,k;l=c.getRowPos(),i=c.bindedComponents,j=[];for(e in i)if(b.call(i,e)){for(h=!1,g=0,f=s.length;f>g;g++)if(k=s[g],""===c.bindedComponents[e].el.attr(k)){h=!0;break}j.push(e===a.uuid||!h&&l!==d.rowIdx?void 0:c.bindedComponents[e].el.trigger("xg-bind-event",a))}return j})(d,e)})},h(this),f&&this.addDataTable(new e(f,g)),this},r=h.prototype,r.makeJSONExportData=function(a){return i(this,[a],!0)},r.makeJSONHeader=function(a){var b,c,e,f,g,h,i,j;for(f={column:[]},e=this.getDataTable(a),j=e.header,h=0,g=j.length;g>h;h++)b=j[h],c=b[d.constant.COLUMN.NAME],i={"@name":c,"@type":b[d.constant.COLUMN.TYPE_OF_GAUCE],"@size":b[d.constant.COLUMN.SIZE].toString(),"@constraint":b[d.constant.COLUMN.CONSTRAINT]},f.column.push(i);return f},r.isBinded=function(a,b){var c;return c=arguments,XgPlatform.XgLogger.debug(function(){return["XgDataSet.isBinded",c]}),this.isExistDataTable(a),this.dataTables[a].bindedComponents[b]?!0:!1},r.bindComponent=function(a,b){var c,e,f;if(e=arguments,XgPlatform.XgLogger.debug(function(){return["XgDataSet.bindComponent",e]}),c=a.data("xg-bind-data-table-id"),f=a.data("xg-uuid"),!c||!f)throw new d.Error("Can not bind not XgUIComponents to XgDataSet",u);return this.isBinded(c,f)||(this.dataTables[c].bindedComponents[f]={el:a,method:b}),this},r.getId=function(){var a;return a=arguments,XgPlatform.XgLogger.debug(function(){return["XgDataSet.getId",a]}),this.id},r.addDataTable=function(a){var b;if(b=arguments,XgPlatform.XgLogger.debug(function(){return["XgDataSet.addDataTable",b]}),!(a instanceof e))throw new d.Error("parameter is not instanceof XgDataTable",u);return this.hasDataTable(a.getId(),!1),a.parent||(a.parent=this),this.dataTables[a.getId()]=a,this},r.hasDataTable=function(a,b){var c;if(c=arguments,XgPlatform.XgLogger.debug(function(){return["XgDataSet.hasDataTable",c]}),b){if(!this.dataTables[a])throw new d.Error("dataTable is not exist in dataSet",u)}else if(this.dataTables[a])throw new d.Error("dataTable is exist in dataSet",u)},r.isExistDataTable=function(a){var b;return b=arguments,XgPlatform.XgLogger.debug(function(){return["XgDataSet.isExistDataTable",b]}),this.dataTables[a]?!0:!1},r.getDataTableIds=function(){var a;return a=arguments,XgPlatform.XgLogger.debug(function(){return["XgDataSet.getDataTableIds",a]}),Object.keys(this.dataTables)},r.getDataTable=function(a){var b;return b=arguments,XgPlatform.XgLogger.debug(function(){return["XgDataSet.getDataTable",b]}),this.dataTables[a]},r.removeDataTable=function(a){var b,d,e,f,g,h,i;for(i=arguments,XgPlatform.XgLogger.debug(function(){return["XgDataSet.removeDataTable",i]}),g=a,a||(g=this.getDataTableIds()),"string"==typeof a&&(g=[a]),f=g.length;f--;)if(e=this.getDataTable(g[f])){for(e.resetDataTable(),d=Object.keys(e.bindedComponents),h=d.length;h--;)b=e.bindedComponents[d[h]],c(b.el)[b.method]("destroy");e.bindedComponents=null,delete this.dataTables[g[f]]}return this},r.setDataAdapter=function(a){var b;if(b=arguments,XgPlatform.XgLogger.debug(function(){return["XgDataSet.setDataAdapter",b]}),!a)throw new d.Error("dataAdapter is not define",u);if(!(a instanceof f))throw new d.Error("dataAdapter is not instanceof DataAdapter",u);return this.dataAdapter=a,this},r.getDataAdapter=function(){var a;if(a=arguments,XgPlatform.XgLogger.debug(function(){return["XgDataSet.getDataAdapter",a]}),!this.dataAdapter)throw new d.Error("dataAdapter is not define",u);return this.dataAdapter},r.select=function(a,b,c){var e,f,h,l,n,r,s,t,v,w,x,y;if(x=arguments,XgPlatform.XgLogger.debug(function(){return["XgDataSet.select",x]}),void 0===c||null===c||"object"!=(v=typeof c)&&"string"!==v||this.getDataAdapter().setParams(c),(void 0===a||null===a)&&(a=this.getDataTableIds()),("string"==(w=typeof a)||"number"===w)&&(a=[a]),!(a instanceof Array))throw new d.Error("Invalid parameter",u);for(h=this,r=!0,f=this.getDataAdapter(),n=f.getDataType(),e=function(a,c,d){var e,f,g,i;if("all"===d){for("XML"===n?e=q(h,a,c):"JSON"===n?e=m(h,a,c):"BIN"===n&&(e=k(h,a,c)),i=0,g=a.length;g>i;i++)f=a[i],XgPlatform.XgLogger.info(function(){return"[ id : "+f+" ] init"}),h.$eventEmitter.trigger("xg-bind-event",{uuid:void 0,eventName:"xgDataTableInit",rowIdx:-1,xgDataTableId:f});return b&&"function"==typeof b&&b(e.result,e.errorMsg,e.messages),h}return"XML"===n?e=p(h,a,c,d,b):"JSON"===n&&(e=o(h,a,c,d,b)),"row"===d&&r&&(r=!1),"message"===d&&(r=!0,b&&"function"==typeof b&&b(e.result,e.errorMsg,e.messages)),h},t=0,s=a.length;s>t;t++)l=a[t],this.getDataTable(l).getUrl("select")&&(y=this.getDataTable(l).getUrl("select"));return"XML"===n?f.CRUD(y,d.constant.CRUD.READ,a,j(this,a),e):f.CRUD(y,d.constant.CRUD.READ,a,g.stringify(i(this,a)),e),this},r.update=function(a,b){var c,e,f,h,k,l,m,o,p,q,r,s,t,v,w,x;if(v=arguments,XgPlatform.XgLogger.debug(function(){return["XgDataSet.update",v]}),(void 0===a||null===a)&&(a=this.getDataTableIds()),("string"==(s=typeof a)||"number"===s)&&(a=[a]),!(a instanceof Array))throw new d.Error("Invalid parameter",u);for(f=this.getDataAdapter(),l=f.getDataType(),"XML"===l&&(r=j(this,a,!1)),"function"==typeof Array.prototype.toJSON&&(w=Array.prototype.toJSON,delete Array.prototype.toJSON),"JSON"===l&&(r=g.stringify(i(this,a))),w&&(Array.prototype.toJSON=w),h=this,c=function(a,c){var d;return d=n(h,a,c),b&&"function"==typeof b&&b(d.result,d.errorMsg,d.messages),h},e=0,p=0,m=a.length;m>p;p++)k=a[p],this.getDataTable(k).getUrl("update")&&e++;if(e>1){for(t=[],q=0,o=a.length;o>q;q++)k=a[q],this.getDataTable(k).getUrl("update")&&(x=this.getDataTable(k).getUrl("update")),k=[k],t.push(f.CRUD(x,d.constant.CRUD.UPDATE,k,r,c));return t}return f.CRUD(this.getDataTable(a[0]).getUrl("update"),d.constant.CRUD.UPDATE,k,r,c)},r.makeListTypeSource=function(a,b,c){var e,f,g,h,i,j,k;if(k=arguments,XgPlatform.XgLogger.debug(function(){return["XgDataSet.makeListTypeSource",k]}),!this.isExistDataTable(a))throw new d.Error("dataTable is not exist in dataSet",u);for(e=this.getDataTable(a),i=[],j=f=0,h=e.getRowCount()-1;h>=0?h>=f:f>=h;j=h>=0?++f:--f)g={},g.text=e.getValue(j,b),g.value=e.getValue(j,c),i.push(g);return i},r.makeTreeTypeSource=function(a,b,c,e){var f,g,h,i,j,k,l,m,n,o,p;if(p=arguments,XgPlatform.XgLogger.debug(function(){return["XgDataSet.makeTreeTypeSource",p]}),!this.isExistDataTable(a))throw new d.Error("dataTable is not exist in dataSet",u);f=this.getDataTable(a),n=f.getRowCount(),k={},l=function(){var a,d,g;for(g=[],o=a=0,d=n-1;d>=0?d>=a:a>=d;o=d>=0?++a:--a)j={},j.level=f.getValue(o,b),j.id=f.getValue(o,c),j.label=f.getValue(o,e),j.value=o,j.expanded=!0,void 0!==k[j.level-1]&&null!==k[j.level-1]&&(j.parent=k[j.level-1]),k[j.level]=j.id,g.push(j);return g}(),m=[];for(g in l)if(j=l[g],void 0===j.parent||null===j.parent)m.push(j);else for(i=0,h=l.length;h>i;i++)if(k=l[i],k.id===j.parent){delete j.parent,(void 0===k.items||null===k.items)&&(k.items=[]),k.items.push(j);break}return m},XgPlatform.XgLogger.info(function(){return u+" : load end"}),h})}).call(this);