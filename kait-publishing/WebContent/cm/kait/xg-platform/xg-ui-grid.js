(function(){"use strict";var a=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};!function(a,b){return"function"==typeof define&&define.amd?define("XgUIGrid",["jquery","XgCommon","XgUICommon"],b):a.XgUIGrid=b(a.jQuery,a.XgCommon,a.XgUICommon)}(window,function(b,c,d){var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B;return B="xg-ui-grid.js",XgPlatform.XgLogger.info(function(){return B+" : load start"}),h=function(a,b){var c,d;return d=a.data("xg-bind-data-table"),void 0!==b.selectedrowindex&&"number"==typeof b.selectedrowindex&&(c=a.jqxGrid("getrowid",b.selectedrowindex),(-1===c||null===c||void 0===c)&&(c=0),d)?d.parent.$eventEmitter.trigger("xg-bind-event",{uuid:a.data("xg-uuid"),eventName:"setRowPos",rowIdx:c,value:c,xgDataTableId:d.getId()}):void 0},i=function(a,b){var c,d,e,f,g,h;for(h=new Array(a.getColumnCount()),f=Object.keys(b),c=d=0,g=f.length;g>d;c=++d)e=f[c],h[a.getColumnIndex(e)]=b[e];return h},j=function(a,b){var c,d,e,f;for(f=[],c=0,e=b.length;e>c;c++)d=b[c],f.push(i(a,d));return f},n=function(a,b){var d,e,f,g,h;for(h={},h["*xgRowStatus"]=c.constant.STATUS.INSERT,f=0,g=a.length;g>f;f++)d=a[f],e=null,b[d[c.constant.COLUMN.NAME]]&&(e=!1),h[d[c.constant.COLUMN.NAME]]=e;return h},k=function(a,b,e){var f,g,h,i,j,k,l,m,n,o,p,q,r,s;if(j=[],j.push({datafield:"*xgRowStatus",type:"number",columntype:"textbox",groupable:!1,editable:!1,filterable:!1,text:"",width:30,cellsrenderer:function(b,d,e){var f,g,h,i;if("*xgRowStatus"===d){switch(h=4,i=a.jqxGrid("rowsheight"),g=a.css("font-size"),"string"==typeof i&&(i=parseInt(i,10)),"string"==typeof g&&(g=parseInt(g,10)),h=i/2-(g+3)/2,4>h&&(h=4),f="-",e){case c.constant.STATUS.UNKNOWN:f="?";break;case c.constant.STATUS.NORMAL:f="-";break;case c.constant.STATUS.INSERT:f="◀";break;case c.constant.STATUS.UPDATE:f="△";break;case c.constant.STATUS.DELETE:f="X"}return"<div style='text-align:center;margin-top:"+h+"px;'>"+f+"</div>"}}}),e.showsequence&&(e.sequencedesc=e.sequencedesc||!1,e.sequencewidth=e.sequencewidth||30,e.sequencetext=e.sequencetext||"번호",j.push({datafield:"*xgSequence",columntype:"number",align:"center",groupable:!1,editable:!1,filterable:!1,text:e.sequencetext,width:e.sequencewidth,cellsrenderer:function(b,c,d){var f,g,h,i,j,k,l;return"*xgSequence"===c?(h=a.xgGrid("pagenum"),i=a.xgGrid("pagesize"),l=a.xgGrid("totalRecords"),g=4,j=a.jqxGrid("rowsheight"),f=a.css("font-size"),"string"==typeof j&&(j=parseInt(j,10)),"string"==typeof f&&(f=parseInt(f,10)),g=j/2-(f+3)/2,4>g&&(g=4),k=a.data("xg-option-virtualmode")?e.sequencedesc===!1?d+1+(h-1)*i:l-d-(h-1)*i:e.sequencedesc===!1?d+1:l-d,"<div style='text-align:center;margin-top:"+g+"px;'>"+k+"</div>"):void 0}})),e.columns)for(q=e.columns,k=0,n=q.length;n>k;k++){for(i=q[k],r=b.header,l=0,o=r.length;o>l;l++)if(f=r[l],i.datafield===f[c.constant.COLUMN.NAME]){i.xgSize=f[c.constant.COLUMN.SIZE],i.xgType=f[c.constant.COLUMN.TYPE_OF_GAUCE],i.xgConstraint=f[c.constant.COLUMN.CONSTRAINT],i.type=d.convertXgDataTypeToJSDataType(f[c.constant.COLUMN.TYPE_OF_GAUCE]),i.columntype||(i.columntype="textbox");break}j.push(i)}else for(s=b.header,g=m=0,p=s.length;p>m;g=++m)f=s[g],i={datafield:f[c.constant.COLUMN.NAME],text:f[c.constant.COLUMN.NAME],type:d.convertXgDataTypeToJSDataType(f[c.constant.COLUMN.TYPE_OF_GAUCE]),xgType:f[c.constant.COLUMN.TYPE_OF_GAUCE],xgConstraint:f[c.constant.COLUMN.CONSTRAINT],xgSize:f[c.constant.COLUMN.SIZE],width:100},h=f[c.constant.COLUMN.NAME],"number"===i.type&&(i.cellsalign="right"),j.push(i);return j},p=function(a,b,c,d){var e,f,g,h,i;if(i=void 0,null===b||void 0===b)return i;for(b instanceof Object&&(b=b[c]),e=g=0,h=a.length;h>g;e=++g)if(f=a[e],f[c].toString()===b.toString()){("text"===d||"value"===d)&&(i=f[d]),"index"===d&&(i=e);break}return i},o=function(a,b){var c,d,e,f,g;if(g=void 0,null===b||void 0===b)return 0;for(c=e=0,f=a.length;f>e;c=++e)if(d=a[c],d.toString()===b.toString()){g=c;break}return g},g=function(a,b,d){var e,f,g,h;for(h=a.data("xg-bind-data-table").header,f=0,g=h.length;g>f;f++)e=h[f],a.jqxGrid("setcolumnproperty",e[c.constant.COLUMN.NAME],b,d);return a},w=function(a,b,d,e){var f,g;if(g=void 0,d instanceof Array)for(g=j(b,d),f=d.length;f--;)d[f]["*xgRowStatus"]=c.constant.STATUS.INSERT;else g=i(b,d),d["*xgRowStatus"]=c.constant.STATUS.INSERT;return a.jqxGrid("addrow",null,d,e),b.parent.$eventEmitter.trigger("xg-bind-event",{uuid:a.data("xg-uuid"),eventName:"addRow",rowIdx:e,value:d,rowValue:g,xgDataTableId:b.getId()})},y=function(a,b,d){var e,f,g;if(delete d.uid,e=a.getRowStatus(b),e===c.constant.STATUS.UNKNOWN||e===c.constant.STATUS.DELETE)throw new c.Error("Can not update row. Row status in [ unkown, delete ]",B);for(g=i(a,d),f=g.length;f--;)a.setValue(b,colIdx,g[colIdx]);return e===c.constant.STATUS.INSERT&&a.setRowStatus(b,e),a.getRowStatus(b)},x=function(a,b){var c,d,e,f,g,h,i;if(i=[],b)for(d=a.jqxGrid("getselectedcells"),g=0,h=d.length;h>g;g++)c=d[g],i.push(c.rowindex);else i=a.jqxGrid("getselectedrowindexes");if(!i.length)return!1;for(e=[],f=i.length;f--;)e.push(a.jqxGrid("getrowid",i[f]));return a.xgGrid("deleterow",e)},t=function(a,b){var c,d;for(c=a.length,d=[];c--;)d.push(delete a[c][b]);return d},v=function(){return b(".jqx-grid-validation, .jqx-grid-validation-arrow-up, .jqx-grid-validation-arrow-down").remove()},u=function(a,b){var c,d;return d=a.data("inner-components"),c=d[b],c&&(c.target[c.method]("destroy"),delete d[b],a.data("inner-components",d)),c=null,a},s=function(a){var b,c;for(b=Object.keys(a.data("inner-components")),c=b.length;c--;)u(a,b[c]);return b=null,a},z=function(a,b,c){var d;return d=a.data("inner-components"),c.target&&c.method&&(d[b]=c,a.data("inner-components",d)),a},f=function(a,b){var c;return c="rowclick",b.indexOf("cell")>-1&&(c="cellclick"),a.on(c,function(b){var c,d;return d=a.data("xg-bind-data-table"),c=a.jqxGrid("getrowid",b.args.rowindex),null!==c&&void 0!==c?d.parent.$eventEmitter.trigger("xg-bind-event",{uuid:a.data("xg-uuid"),eventName:"setRowPos",rowIdx:c,value:c,xgDataTableId:d.getId()}):void 0})},q=function(a){var b,c,d,e;return d={start:0,end:0},"number"==typeof a.selectionStart&&"number"==typeof a.selectionEnd?(d.start=a.selectionStart,d.end=a.selectionEnd):document.selection&&(c=document.selection.createRange().getBookmark(),e=a.createTextRange(),b=e.duplicate(),e.moveToBookmark(c),b.setEndPoint("EndToStart",e),d.start=b.text.length,d.end=d.start+e.text.length),d},m=function(e,g,h){var i,j,k,l,m,r,s,w,y,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la;if(Y={},m=e.data("xg-bind-option"),b.extend(!0,Y,m,g),e.data("xg-bind-option",Y),la=e.data("xg-bind-data-table"),e.data("xg-bind-data-table-id",la.getId()),ja=e.jqxGrid("selectionmode"),e.data("xg-uuid")||(d.removeEvents(e,["rowclick","cellclick","cellvaluechanged","xg-bind-event","pagechanged"]),e.data("inner-components",{}),e.on("xg-bind-event",function(a,b){var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v;if(b.uuid===e.data("xg-uuid"))return!1;if(la.getId()!==b.xgDataTableId)return!1;if("setValue"===b.eventName){if("column"===b.bind.type){for(h=!1,o=e.jqxGrid("columns").records,j=0,m=o.length;m>j;j++)if(f=o[j],f.displayfield===b.bind.column){h=!0;break}h&&la.getRowStatus(b.rowIdx)!==c.constant.STATUS.DELETE&&e.jqxGrid("setcellvaluebyid",b.rowIdx,b.bind.column,b.value),(p=la.getRowStatus(b.rowIdx))!==c.constant.STATUS.INSERT&&p!==c.constant.STATUS.DELETE&&e.jqxGrid("setcellvaluebyid",b.rowIdx,"*xgRowStatus",c.constant.STATUS.UPDATE)}"row"===b.bind.type&&console.warn("[ xgGrid setValue listner ] row type의 경우 향후 구현 예정")}if("xgDataTableInit"===b.eventName&&(e.jqxGrid("clearselection"),e.jqxGrid({source:d.createUIAdapter(la,"xgGrid")})),"addRow"===b.eventName)if(b.value instanceof Array){for(u=[],v=e.jqxGrid("getboundrows").length,g=v+b.value.length,i=k=q=v,r=g;r>=q?r>=k:k>=r;i=r>=q?++k:--k)u.push(i);e.jqxGrid("addrow",u,b.value)}else e.jqxGrid("addrow",null,b.value,b.rowIdx),t=la.getRowCount()-1,e.jqxGrid("setcellvaluebyid",t,"*xgRowStatus",c.constant.STATUS.INSERT);if("deleteRow"===b.eventName){for(e.jqxGrid("beginupdate",!0),s=b.value,l=0,n=s.length;n>l;l++)t=s[l],e.jqxGrid("setcellvaluebyid",t,"*xgRowStatus",c.constant.STATUS.DELETE);return e.jqxGrid("endupdate")}}),f(e,ja),e.on("cellvaluechanged",function(a){var b,f,g,h,i;return-1===la.getColumnIndex(a.args.datafield)?!0:(e.data("xg-grid-edit-status",!1),"*xgRowStatus"===a.args.datafield?!1:a.args.oldvalue&&a.args.newvalue&&a.args.oldvalue.toString()===a.args.newvalue.toString()?!1:(h=e.jqxGrid("getrowid",a.args.rowindex),i=la.getRowStatus(h),i===c.constant.STATUS.DELETE?!1:(f=a.args.newvalue,f instanceof Object&&null!==(g=f.value)&&void 0!==g&&(f=f.value),b={bind:{type:"column",column:a.args.datafield}},d.setBindColInfo(la,b),la.parent.$eventEmitter.trigger("xg-bind-event",{uuid:e.data("xg-uuid"),eventName:"setValue",bind:b.bind,value:f,rowIdx:h,rowValue:la.getRow(h),xgDataTableId:la.getId()}),c.constant.STATUS.INSERT!==la.getRowStatus(h)&&e.jqxGrid("setcellvaluebyid",h,"*xgRowStatus",c.constant.STATUS.UPDATE),!0)))}),e.on("pagechanged ",function(a){var b;return b=a.args,e.data("xg-option-pagenum",b.pagenum+1)}),d.setUUID(e),la.parent.bindComponent(e,"jqxGrid")),L=d.getLocaleCode(),U=d.getLocalization(L),B={},!g)return e;if(h.columns||(h.columns=e.jqxGrid("columns").records),g.template)for(D=d.constant.GRID.TEMPLATE[g.template.toUpperCase()],G=0,M=D.length;M>G;G++)C=D[G],I=Object.keys(C)[0],(void 0===(ba=g[I])||null===ba)&&(g[I]=C[I]);if(e.jqxGrid("beginupdate",!0),B.handlekeyboardnavigation=function(a){var c,d,f,g,h,i,j,k,l,n,o,p,r,s,t;if(o=b(a.target.parentElement).attr("id"),t=e.attr("id"),"string"==typeof o&&o.replace(/wrapper/g,"")!==t)return!1;if(I=void 0,I=a.charCode?a.charCode:a.keyCode?a.keyCode:0,!e.data("xg-grid-edit-status")){if(f=!1,k=-1,ja.indexOf("cell")>-1?(l=e.jqxGrid("getselectedcell"),l&&(k=l.rowindex),f=!0):k=e.jqxGrid("getselectedrowindex"),38===I&&k>0)return e.jqxGrid("clearselection"),f?e.xgGrid("selectcell",k-1,l.datafield):(p=e.jqxGrid("getrowid",k-1),e.xgGrid({selectedrowindex:k-1})),e.jqxGrid("pageable")&&(h=e.jqxGrid("getdatainformation").paginginformation,k===h.pagenum*h.pagesize&&e.jqxGrid("gotoprevpage")),!0;if(40===I&&k<e.jqxGrid("getboundrows").length-1)return e.jqxGrid("clearselection"),f?e.xgGrid("selectcell",k+1,l.datafield):e.xgGrid({selectedrowindex:k+1}),e.jqxGrid("pageable")&&(h=e.jqxGrid("getdatainformation").paginginformation,k+1===(h.pagenum+1)*h.pagesize&&e.jqxGrid("gotonextpage")),!0;if(46===I&&("INPUT"===(i=a.target.nodeName)||"TEXTAREA"===i))return r=b(a.target).data("xg-uuid"),s=b(a.target).val(),n=q(a.target),n.start===n.end&&(n.end+=1),d=s.substr(0,n.start),c=s.substr(n.end,s.length),j=d+c,b(a.target).val(j),b(a.target).setCursorPosition(n.start),r&&(g=e.data("xg-bind-data-table"),m=b(a.target).data("xg-bind-option"),"write"===m.mode&&(g.parent.$eventEmitter.trigger("xg-bind-event",{uuid:r,eventName:"setValue",rowIdx:g.getRowPos(),bind:{column:m.bind.column,columnIndex:m.bind.columnIndex,type:m.bind.type},value:j,xgDataTableId:g.getId()}),b(a.target).setCursorPosition(n.start))),!0;if(46===I&&e.jqxGrid("enablekeyboarddelete"))return x(e,f),!0}return!1},g.contextMenu===!1&&(d.removeEvents(e,["contextmenu","rowclick","cellclick","mousedown"]),u(e,"contextMenu"),u(e,"outerContextMenu"),f(e,ja)),g.contextMenu){if(ka=e.data("xg-uuid"),d.removeEvents(e,["contextmenu","rowclick","cellclick"]),u(e,"contextMenu"),u(e,"outerContextMenu"),e.on("contextmenu",function(){return!1}),i=b("<div></div>"),F="<ul>",g.contextMenu.rowControl&&(F+=d.constant.GRID.MARKUP.CONTEXT_MENU),g.contextMenu["export"]&&(F+=d.constant.GRID.MARKUP.EXPORT_MENU),F+="</ul>",i.html(F),j=i.find("li"),"en"!==L)for(X=H=0,N=j.length;N>H;X=++H)W=j[X],b(W).html(U[b(W).data("xg-bind-method")]);if(i.jqxMenu({width:230,height:26*j.length+4,autoOpenPopup:!1,mode:"popup"}),k=b("<div></div>"),k.html(d.constant.GRID.MARKUP.OUTER_CONTEXT_MENU),l=k.find("li"),"en"!==L)for(X=K=0,O=l.length;O>K;X=++K)W=l[X],b(W).html(U[b(W).data("xg-bind-method")]);k.jqxMenu({width:210,height:26*l.length+4,autoOpenPopup:!1,mode:"popup"}),b("body").append(i),b("body").append(k),z(e,"contextMenu",{method:"jqxMenu",target:i}),z(e,"outerContextMenu",{method:"jqxMenu",target:k}),w=function(){return i.jqxMenu("close"),k.jqxMenu("close")},f(e,ja),s="rowclick",ia="selectrow",ja.indexOf("cell")>-1&&(s="cellclick",ia="selectcell"),e.on(s,function(a){var c,d;return w(),a.args.rightclick?(d=b(window).scrollTop(),c=b(window).scrollLeft(),i.jqxMenu("open",parseInt(a.args.originalEvent.clientX,10)+5+c,parseInt(a.args.originalEvent.clientY,10)+5+d),ja.indexOf("multiple")>-1&&e.jqxGrid("clearselection"),"selectcell"===ia&&e.jqxGrid(ia,a.args.rowindex,a.args.datafield),"selectrow"===ia&&e.jqxGrid(ia,a.args.rowindex),!0):!1}),e.on("mousedown",function(a){var c,d,f,h;return w(),c=void 0,a||(a=window.event),a.which?c=3===a.which:a.button&&(c=2===a.button),c&&(d=e.jqxGrid("getboundrows"),1>d.length&&g.contextMenu.rowControl&&(h=b(window).scrollTop(),f=b(window).scrollLeft(),k.jqxMenu("open",parseInt(a.clientX,10)+5+f,parseInt(a.clientY,10)+5+h))),!0}),i.on("itemclick",function(a){var c,f,h,i,j;return c=a.args,f=la.body.length,h=b("#"+c.id).data("xg-bind-method"),h.indexOf("insertRow")>-1&&(i=h.substring(9),h=h.substring(0,9),j=0,"After"===i&&(j=1),e.xgGrid("addrow",null,n(la.header,la.booleanColumn),e.xgGrid("getselectedrowindex")+j)),"addRow"===h&&e.xgGrid("addrow",null,n(la.header,la.booleanColumn)),"addRowTop"===h&&e.xgGrid("addrow",null,n(la.header,la.booleanColumn),"top"),"deleteRow"===h&&x(e),"exportExcel"===h&&e.xgGrid("exportdata","xls",d.getToday(),!0,null,!0,g.actionUrl||"/XG/ix-export.xex","UTF-8"),"exportJSON"===h&&e.xgGrid("exportdata","json",d.getToday(),!0,null,!0),!1}),k.on("itemclick",function(a){var c;return c=b("#"+a.args.id).data("xg-bind-method"),"addRow"===c&&e.xgGrid("addrow",null,n(la.header,la.booleanColumn)),!1})}if(g.locale||(g.locale=d.getLocaleCode()),g.locale&&("string"==typeof g.locale&&(g.locale=d.getLocalization(g.locale)),e.jqxGrid("localizestrings",g.locale)),r=!1,h.columns&&e.data("xg-columns-origin",h.columns),h.columns||(h.columns=e.data("xg-columns-origin")),g.cellEdit===!1&&(r=!0,t(h.columns,"cellbeginedit")),g.cellEdit)for(r=!0,ca=h.columns,A=V=0,P=ca.length;P>V;A=++V)y=ca[A],-1!==la.getColumnIndex(y.datafield)&&(E=function(a,b){return h.columns[b].cellbeginedit=function(b,d){var f,g,h;return e.data("xg-grid-edit-status",!0),g=e.jqxGrid("getrowid",b),h=la.getRowStatus(g),"key"===(f=a.xgConstraint)||"sequence"===f?h===c.constant.STATUS.INSERT?!0:h===c.constant.STATUS.DELETE?(console.warn("Row already deleted."),!1):d===a.datafield?(console.warn("You can not editing Key or sequence columns."),!1):!0:h===c.constant.STATUS.DELETE?(console.warn("Row already deleted."),!1):!0},h.columns[b].cellendedit=function(){return e.data("xg-grid-edit-status",!1)}})(y,A);if(g.cellValidation===!1&&(r=!0,t(h.columns,"validation"),t(h.columns,"cellclassname")),g.cellValidation)for(r=!0,da=h.columns,A=Z=0,Q=da.length;Q>Z;A=++Z)y=da[A],-1!==la.getColumnIndex(y.datafield)&&(E=function(b,d){return h.columns[d].validation=function(d,e){var f,h;if("normal"!==b.xgConstraint&&(f=[null,void 0],b.xgConstraint===c.constant.CONSTRAINT.KEY&&f.push(""),a.call(f,e)>=0))return{result:!1,message:g.locale.required};if(("number"===(h=b.type)||"float"===h)&&void 0!==e&&null!==e&&(e=parseInt(e.toString(),10),"number"!=typeof e))return{result:!1,message:g.locale.requiredNumber};if("date"===b.type){if(isNaN(Date.parse(e)))return{result:!1,message:g.locale.requiredDate}}else if(e.toString().length>b.xgSize)return{result:!1,message:b.xgSize+g.locale.overflowMaxNumber};return!0},h.columns[d].cellclassname=function(a,c,d){var e,f;return e="","key"!==(f=b.xgConstraint)&&"sequence"!==f||null!==d&&void 0!==d&&""!==d||(e="cell-invalidate"),"notnull"!==b.xgConstraint||null!==d&&void 0!==d||(e="cell-invalidate"),e}})(y,A);if(g.columnFormat===!1&&(r=!0,t(h.columns,"cellsformat")),g.columnFormat)for(r=!0,ea=h.columns,A=$=0,R=ea.length;R>$;A=++$)y=ea[A],-1!==la.getColumnIndex(y.datafield)&&(y.cellsformat||("date"===y.type&&(h.columns[A].cellsformat="yyyy-MM-dd"),"datetime"===y.type&&(h.columns[A].cellsformat="yyyy-MM-dd HH:mm:ss"),"number"===y.type&&(h.columns[A].cellsformat="n"),"float"===y.type&&(h.columns[A].cellsformat="d2")));if(g.showRowStatus===!1?e.jqxGrid("hidecolumn","*xgRowStatus"):e.jqxGrid("showcolumn","*xgRowStatus"),g.useEditor===!1&&(r=!0,t(h.columns,"columntype"),t(h.columns,"initeditor")),g.useEditor===!0)for(r=!0,fa=h.columns,A=_=0,S=fa.length;S>_;A=++_)y=fa[A],"*xgRowStatus"!==(ga=y.datafield)&&"*xgSequence"!==ga&&-1!==la.getColumnIndex(y.datafield)&&(E=function(a,b){var d;return"number"===a.type&&(h.columns[b].columntype="numberinput"),("date"===(d=a.type)||"datetime"===d)&&(h.columns[b].columntype="datetimeinput"),h.columns[b].columntype?h.columns[b].initeditor=function(d,e,f){var g;switch(g=void 0,C=void 0,a.type){case"number":C="jqxNumberInput",g={decimal:0,max:c.constant.RANGE_OF_GAUCE[a.xgType.toUpperCase()].MAX,min:c.constant.RANGE_OF_GAUCE[a.xgType.toUpperCase()].MIN,digits:h.columns[b].xgSize,decimalDigits:0};break;case"float":C="jqxNumberInput",g={decimal:2,max:c.constant.RANGE_OF_GAUCE.DECIMAL.MAX,min:c.constant.RANGE_OF_GAUCE.DECIMAL.MIN,digits:h.columns[b].xgSize,decimalDigits:2};break;case"date":C="jqxDateTimeInput",g={formatString:U.patterns.d,dayNameFormat:"firstLetter"};break;case"datetime":C="jqxDateTimeInput",g={formatString:U.patterns.F,dayNameFormat:"firstLetter"}}if(C&&g)switch(f[C](g),a.type){case"number":case"float":return f[C]("val",e);case"date":case"datetime":if(!e)return e=c.getGauceDateStr(new Date)}}:void 0})(y,A);if(g.useEditor instanceof Object)for(r=!0,J=Object.keys(g.useEditor),ha=h.columns,A=aa=0,T=ha.length;T>aa;A=++aa)y=ha[A],"*xgRowStatus"!==y.datafield&&-1!==la.getColumnIndex(y.datafield)&&(E=function(f,i){var j,k,l,m,n,q,r,s;if(r=f.datafield,a.call(J,r)<0)return!1;if(C=void 0,n=void 0,l=g.useEditor[f.datafield],"dropdownlist"!==(s=l.columntype)&&"checkbox"!==s&&"passwordinput"!==s&&"numberinput"!==s&&"datetimeinput"!==s)return!1;switch(l.source||(l.source=[]),l.columntype){case"dropdownlist":C="jqxDropDownList";break;case"checkbox":C="jqxCheckBox";break;case"passwordinput":C="jqxPasswordInput";break;case"numberinput":C="jqxNumberInput";break;case"datetimeinput":C="jqxDateTimeInput"}return q="object"==typeof l.source[0],delete h.columns[i].validation,m=l.columntype,h.columns[i].columntype=m,"passwordinput"===m&&(h.columns[i].columntype="custom"),j=function(a,b,c){return c&&a[b](c),c?void 0:a[b]()},(k=function(a){return"checkbox"===m&&(h.columns[i].cellbeginedit=function(a){var b,d;return e.data("xg-grid-edit-status",!1),d=e.jqxGrid("getrowid",a),(b=la.getRowStatus(d))===c.constant.STATUS.DELETE?(console.warn("Row already deleted."),!1):(e.jqxGrid({selectedrowindex:a}),!0)},l.checkedAll&&(h.columns[i].rendered=function(c){var g,j,k;return g=b(c),k=b(c).last().text(),g.last().append('<span class="xg-checked-all">'+k+"</span>"),b(c).find("span:not(.xg-checked-all)").remove(),j={width:16,height:16,animationShowDelay:0,animationHideDelay:0,enableContainerClick:!0},h.theme&&(j.theme=h.theme),g[a](j),g.css("width","100%"),d.removeEvents(g,["click","change"]),g.on("click",function(a){return a.stopPropagation()}),g.on("change",function(a){var b,c,d,g;for(e.jqxGrid("beginupdate"),c=a.args.checked,i=d=0,g=e.jqxGrid("getrows").length-1;g>=0?g>=d:d>=g;i=g>=0?++d:--d)b=e.jqxGrid("getrowboundindex",i),e.jqxGrid("setcellvalue",b,f.datafield,c);return e.jqxGrid("endupdate")})}),l.checkedAll===!1&&(h.columns[i].rendered=function(a){var c;return c=b(b(a).find("span.xg-checked-all")),c?c.remove():void 0})),"datetimeinput"===m&&(h.columns[i].initeditor=function(b,d,e){var f;return f=d,f||(f=c.getGauceDateStr(new Date)),"string"==typeof f&&8===f.length&&(f=new Date(c.getDateStrFromGauceDate(d))),e[a]("setDate",f)},h.columns[i].cellvaluechanging=function(a,b,c,d,e){return e&&d!==e?e:d}),"passwordinput"===m&&(h.columns[i].createeditor=function(c,d,e){var g;return g=b('<input type="password" style="width: 100%; height: 100%;">'),e.append(g),l.option||(l.option={maxLength:f.xgSize}),j(g,a,l.option)},h.columns[i].initeditor=function(b,c,d){var e;return v(),e=d.find('input[type="password"]:first'),e[a]("val",c),e.focus()},h.columns[i].geteditorvalue=function(a,b,c){var d;return d=c.find('input[type="password"]:first'),d.val()},h.columns[i].cellsrenderer=function(a,b,c){var d;return d=c.replace(/./gi,"●"),"<div style='margin-top:4px;margin-left:4px;'> "+d+" </div>"},h.columns[i].cellvaluechanging=function(a,b,c,d,h){return null===h||void 0===h||d===h?d:(g.cellValidation&&h.length>f.xgSize&&e.jqxGrid("showvalidationpopup",a,f.datafield,""+f.xgSize+g.locale.overflowMaxNumber),h)},h.columns[i].destroyeditor=function(a){return b(a).jqxPasswordInput("destroy")}),"numberinput"===m&&(h.columns[i].initeditor=function(b,c,d){return j(d,a,l.option)}),"dropdownlist"===m?(h.columns[i].initeditor=function(b,c,d){var e;return n={autoDropDownHeight:!0},l.source.length&&(n.source=l.source,l.source.length>6&&(n.autoDropDownHeight=!1,n.dropDownHeight=200)),q&&(n.valueMember="value",n.displayMember="text"),j(d,a,n),e=-1,q&&(e=p(l.source,c,"value","index")),q||(e=o(l.source,c)),n.source||(e=p(d[a]("source").records,c,f.datafield,"index")),(null===e||void 0===e)&&(e=0),d[a]("selectIndex",e)},h.columns[i].cellsrenderer=function(a,b,c){var d,e,f;return f=void 0,q||(f=c),q&&(f=c instanceof Object?c.text:p(l.source,c,"value","text")),(null===f||void 0===f)&&(f=c),d=h.columns[i].cellsalign,e||(e="left"),"<div style='margin-top:4px;margin-left:4px;text-align:"+d+";'> "+f+" </div>"},h.columns[i].cellvaluechanging=function(a,b,c,d,g){var h,i,j;return i=void 0,h={},q&&(i=p(l.source,g,"text","value"),h=i),q||(i=g,h=i),null===i||void 0===i?d:d&&d.toString()===i.toString()?d:(j=e.jqxGrid("getrowid",a),e.jqxGrid("setcellvaluebyid",j,f.datafield,h),h)}):void 0})(C)})(y,A);return g.groupSubsum===!1&&(r=!0,delete B.groupsrenderer),g.groupSubsum&&(r=!0,B.groupsrenderer=function(a,b,c,d){var e,f,i,j,k,l,m,n,o,p,q,r,s,t,u;for(J=Object.keys(g.groupSubsum),k={},d.subItems.length&&J.length?(E=function(a,b){var c,d,e,f;for(f=[],e=0,d=a.length;d>e;e++)I=a[e],c=this.getcolumnaggregateddata(I,g.groupSubsum[I],!0,b.subItems),f.push(k[I]=c);return f},E.apply(this,[J,d])):(s=[],j=function(a,b){var c,d,e,f,g,h;if(a.subGroups.length){for(f=a.subGroups,g=[],c=e=0,d=f.length;d>e;c=++e)h=f[c],g.push(j(a.subGroups[c],b));return g}return b=a.subItems.map(function(a){return a})},j(d,s),E=function(a,b,c){var d,e,f,h;for(h=[],f=0,e=a.length;e>f;f++)I=a[f],d=this.getcolumnaggregateddata(I,g.groupSubsum[I],!0,c),h.push(k[I]=d);return h},E.apply(this,[J,d,s])),r="<div style='position: relative; margin: 4px; overflow: hidden;'>"+a+" [ ",p=0,n=J.length;n>p;p++)for(I=J[p],q=h.columns,t=0,o=q.length;o>t;t++)if(y=q[t],I===y.datafield){for(i=y.text,"*xgRowStatus"===y.datafield||y.text||(i=""+y.datafield),l=Object.keys(k[I]),f=u=0,m=l.length;m>u;f=++u)e=l[f],i+=" "+e+" : "+k[I][e],f+1!==l.length&&(i+=", ");r+=i}return r+=" ]</div>"}),r&&(B.columns=h.columns),e.jqxGrid(B),e.jqxGrid("refreshdata"),e.jqxGrid("endupdate"),e},r=function(a,b,c,d,e){return a.jqxGrid("showloadelement"),a.data("xg-option-pagenum",d),b.getDataAdapter().setParams({START:(d-1)*e,PAGESIZE:e}),b.select(c)},l=function(a){return function(){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,s;return d=a.data("xg-bind-data-table"),e=d.getId(),c=d.parent,l=a.jqxGrid("pagesize"),j=a.jqxGrid("pagerheight"),o=a.jqxGrid("theme"),k=a.data("xg-option-pagenum")||1,s=c.totalRecords[e]||0,a.data("xg-option-totalrecords",s),q=0===Math.floor(s%l)?Math.floor(s/l):Math.floor(s/l)+1,n=(k-1)*l+1,g=k*l,p=(j-17)/2,0===s&&(n=0,g=0),g>s&&(g=s),f=b("<div width: 98%; height: 98%;'></div>"),f.css("margin-top",p),i=b("<div><div></div></div>"),i.find("div").addClass("jqx-icon-arrow-left"),i.jqxButton({theme:o}),m=b("<div><div></div></div>"),m.find("div").addClass("jqx-icon-arrow-right"),m.jqxButton({theme:o}),h=b("<div style='font-size: 11px; margin-right:10px; margin-left: 10px; font-weight: bold; float: right;'></div>"),h.text(k>q?q+" / "+q:k+" / "+q),i.css("float","right"),m.css("float","right"),m.appendTo(f),i.appendTo(f),h.appendTo(f),s>0&&(m.click(function(){return k!==q&&0!==s?(q>k&&(k+=1),r(a,c,e,k,l)):void 0}),i.click(function(){return 1!==k&&0!==s?(k>1&&(k-=1),r(a,c,e,k,l)):void 0})),f}},A=function(a){return function(){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,s,t,u,v,w,x,y,z,A,B,C,D,E,F;for(d=a.data("xg-bind-data-table"),e=d.getId(),c=d.parent,u=a.jqxGrid("pagesize"),s=a.jqxGrid("pagerheight"),B=a.jqxGrid("theme"),t=a.data("xg-option-pagenum")||1,v=a.jqxGrid("pagerbuttonscount"),F=c.totalRecords[e]||0,a.data("xg-option-totalrecords",F),E=0===Math.floor(F%u)?Math.floor(F/u):Math.floor(F/u)+1,q=Math.floor((t-1)/v),D=Math.floor((E-1)/v),z=q*v+1,A=(t-1)*u+1,g=t*u,C=(s-17)/2,0===F&&(A=0,g=0),g>F&&(g=F),f=b("<div style='width: 98%; height: 98%; text-align: center;'></div>"),f.css("margin-top",C),h=b("<div type='button'><div></div></div>"),h.find("div").addClass("jqx-icon-arrow-first"),h.jqxButton({theme:B}),h.click(function(){return t=1,r(a,c,e,t,u)}),h.mouseenter(function(){return h.find("div").addClass("jqx-icon-arrow-first-hover")}),h.mouseleave(function(){return h.find("div").removeClass("jqx-icon-arrow-first-hover")}),h.mousedown(function(){return h.find("div").addClass("jqx-icon-arrow-first-selected")}),h.mouseup(function(){return h.find("div").removeClass("jqx-icon-arrow-first-selected")}),n=b("<div type='button'><div></div></div>"),n.find("div").addClass("jqx-icon-arrow-left"),n.jqxButton({theme:B}),n.mouseenter(function(){return n.find("div").addClass("jqx-icon-arrow-left-hover")}),n.mouseleave(function(){return n.find("div").removeClass("jqx-icon-arrow-left-hover")}),n.mousedown(function(){return n.find("div").addClass("jqx-icon-arrow-left-selected")}),n.mouseup(function(){return n.find("div").removeClass("jqx-icon-arrow-left-selected")}),p=b("<div class='jqx-number-block'></div>"),m=b("<a class='jqx-grid-pager-number'>...</a>"),m.css("cursor","pointer"),m.mouseenter(function(){return m.addClass("jqx-fill-state-hover")}),m.mouseleave(function(){return m.removeClass("jqx-fill-state-hover")}),x=b("<a class='jqx-grid-pager-number'>...</a>"),x.css("cursor","pointer"),x.mouseenter(function(){return x.addClass("jqx-fill-state-hover")}),x.mouseleave(function(){return x.removeClass("jqx-fill-state-hover")}),m.appendTo(p),i=j=0,w=v-1;(w>=0?w>=j:j>=w)&&!(z+i>E);i=w>=0?++j:--j)t===z+i?o=b("<a class='jqx-grid-pager-number jqx-fill-state-pressed'>"+t+"</a>"):(o=b("<a class='jqx-grid-pager-number'>"+(z+i)+"</a>"),o.css("cursor","pointer"),function(d){return o.click(function(){return 0!==F?(t=d,r(a,c,e,t,u)):void 0}),o.mouseenter(function(a){return b(a.target).addClass("jqx-fill-state-hover")}),o.mouseleave(function(a){return b(a.target).removeClass("jqx-fill-state-hover")})}(z+i)),o.appendTo(p);return x.appendTo(p),m.css("display",0===q?"none":"inline"),x.css("display",q===D?"none":"inline"),y=b("<div type='button'><div></div></div>"),y.find("div").addClass("jqx-icon-arrow-right"),y.jqxButton({theme:B}),y.mouseenter(function(){return y.find("div").addClass("jqx-icon-arrow-right-hover")}),y.mouseleave(function(){return y.find("div").removeClass("jqx-icon-arrow-right-hover")}),y.mousedown(function(){return y.find("div").addClass("jqx-icon-arrow-right-selected")}),y.mouseup(function(){return y.find("div").removeClass("jqx-icon-arrow-right-selected")}),l=b("<div type='button'><div></div></div>"),l.find("div").addClass("jqx-icon-arrow-last"),l.jqxButton({theme:B}),l.click(function(){return t=E,r(a,c,e,t,u)}),l.mouseenter(function(){return l.find("div").addClass("jqx-icon-arrow-last-hover")}),l.mouseleave(function(){return l.find("div").removeClass("jqx-icon-arrow-last-hover")}),l.mousedown(function(){return l.find("div").addClass("jqx-icon-arrow-last-selected")}),l.mouseup(function(){return l.find("div").removeClass("jqx-icon-arrow-last-selected")}),k=b("<div style='font-size: 11px;font-weight: bold; float: right;'></div>"),k.text(t>E?E+" / "+E:t+" / "+E),h.appendTo(f),n.appendTo(f),p.appendTo(f),y.appendTo(f),l.appendTo(f),F>0&&(y.click(function(){return t!==E&&0!==F?(E>t&&(t+=1),r(a,c,e,t,u)):void 0}),n.click(function(){return 1!==t&&0!==F?(t>1&&(t-=1),r(a,c,e,t,u)):void 0}),x.click(function(){return E>t&&(t=z+v),r(a,c,e,t,u)}),m.click(function(){return t>1&&(t=z-v),r(a,c,e,t,u)})),f}},b.fn.xgGrid=function(){var a,e,f,g,i,j,o,p,q,r,t,u,v,x,y,z,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,aa,ba,ca,da,ea,fa;if(r=this,this.selector&&(r=this.selector),_=arguments,XgPlatform.XgLogger.debug(function(){return["XgUIGrid",r,_]}),b(r).attr("data-xg-grid",""),M=void 0,1===arguments.length&&"object"==typeof arguments[0]){if(M=arguments[0],a=void 0,i=M.blocksize?M.blocksize:5,b(r).data("xg-option-blocksize",i),delete M.blocksize,g=M.blockalign?M.blockalign:"left",b(r).data("xg-option-blockalign",g),delete M.blockalign,O=M.pagenum?M.pagenum:1,b(r).data("xg-option-pagenum",O),delete M.pagenum,M.xgInitOption){if(J={},x=b(r).data("xg-init-option"),b.extend(!0,J,x,M.xgInitOption),b(r).data("xg-init-option",J),ea=void 0,"string"==typeof M.xgInitOption.xgDataSet&&(M.xgInitOption.xgDataSet=c.getDataSet(M.xgInitOption.xgDataSet)),ea=M.xgInitOption.xgDataSet,!M.xgInitOption.xgDataSet||!M.xgInitOption.xgDataTable)return M.source=M.xgInitOption.source,M.columns=M.xgInitOption.columns,delete M.xgInitOption,delete M.xgBindOption,b(r).jqxGrid(M);if(fa=void 0,"string"==typeof M.xgInitOption.xgDataTable){if(!M.xgInitOption.xgDataSet)throw new c.Error("Require xgDataSet option property",B);fa=M.xgInitOption.xgDataSet.getDataTable(M.xgInitOption.xgDataTable)}"object"==typeof M.xgInitOption.xgDataTable&&(fa=M.xgInitOption.xgDataTable),b(r).data("xg-bind-data-table",fa),j=k(b(r),fa,M.xgInitOption),fa.uiAdapter=d.createUIAdapter(fa,"xgGrid"),M.source=fa.uiAdapter,M.columns=j,da=M.xgBindOption,delete M.xgInitOption,delete M.xgBindOption,M.virtualmode&&(b(r).data("xg-option-virtualmode",!0),M.pageable=M.pageable||!0,ba=M.theme||b(r).jqxGrid("theme"),Q=M.pagesize||100,ea&&ea.getDataAdapter().setParams({START:(O-1)*Q,PAGESIZE:Q}),K=M.pagermode||"default",P="simple"===K?A(b(r)):l(b(r)),M.pagerrenderer=P,delete M.virtualmode),a=b(r).jqxGrid(M),m(a,da,M)}else M.xgBindOption?(da=M.xgBindOption,delete M.xgBindOption,a=b(r).jqxGrid(M),m(a,da,M)):(a=b(r).jqxGrid(M),D=d.getLocaleCode(),H=d.getLocalization(D),a.jqxGrid("localizestrings",H));return h(b(r),M),a}if(b(r).data("xg-bind-data-table")&&arguments.length>0){if(a=b(r),t=Array.prototype.slice.call(arguments,0,1)[0],N=Array.prototype.slice.call(arguments,1,arguments.length),f=a.data("xg-bind-data-table"),"exportdata"===t&&(x=b(r).data("xg-init-option"),x.showsequence))for(ca=a.jqxGrid("source"),u=y=0,R=ca.records.length-1;R>=0?R>=y:y>=R;u=R>=0?++y:--y)ca.records[u]["*xgSequence"]=x.sequencedesc?ca.records.length-u:u+1;if("addrow"===t){if(o=a.jqxGrid("getselectedrowindex"),e=a.jqxGrid("getrowid",o),$=void 0,"number"==typeof N[2]&&($=N[2]),("top"===(S=N[2])||"first"===S)&&($=0),v=0,(void 0===(T=N[1])||null===T)&&(N[1]={}),void 0!==(U=N[1])&&null!==U&&"object"==typeof N[1])if(N[1]instanceof Array){for(v=N[1].length,V=N[1],q=z=0,E=V.length;E>z;q=++z)p=V[q],Object.keys(p).length||(arguments[2][q]=n(f.header,f.booleanColumn));w(a,f,arguments[2],N[2])}else N[1]instanceof Object&&(Object.keys(N[1]).length||(arguments[2]=n(f.header,f.booleanColumn)),w(a,f,arguments[2],N[2]),v=1);return void 0!==$&&null!==$&&o>=$&&(o+=v),(void 0===$||null===$)&&(o=0),-1!==a.jqxGrid("selectedrowindex")&&a.jqxGrid({selectedrowindex:o}),a}if("removerow"===t){for("number"==typeof N[0]&&(arguments[1]=[N[0]]),Y=[],W=arguments[1],C=0,F=W.length;F>C;C++)$=W[C],Z=a.jqxGrid("getrowid",$),"string"==typeof Z&&(Z=parseInt(Z.toString(),10)),a.jqxGrid("getcellvaluebyid",Z,"*xgRowStatus")===c.constant.STATUS.INSERT?a.xgGrid("deleterow",$):(a.jqxGrid("setcellvaluebyid",Z,"*xgRowStatus",c.constant.STATUS.DELETE),
Y.push(Z));return Y.length>0&&f.parent.$eventEmitter.trigger("xg-bind-event",{uuid:a.data("xg-uuid"),eventName:"deleteRow",rowIdx:void 0,value:Y,xgDataTableId:f.getId()},console.log("removerow trigger")),a}if("deleterow"===t){for("number"==typeof N[0]&&(arguments[1]=[N[0]]),X=arguments[1],I=0,G=X.length;G>I;I++)$=X[I],Z=a.jqxGrid("getrowid",$),"string"==typeof Z&&(Z=parseInt(Z.toString(),10)),a.jqxGrid("deleterow",Z),a.jqxGrid("setcellvaluebyid",Z,"*xgRowStatus",c.constant.STATUS.DELETE),f.body[Z].status=c.constant.STATUS.DELETE;return a}if("destroy"===t&&s(a),"setcolumnindex"===t){if("number"!=typeof arguments[2])throw new c.Error("Can not change column index. args[ 2 ] is not number.",B);arguments[2]=arguments[2]+1}if("xgSelect"===t&&f.parent)return f.parent.select([f.getId()],function(b,e,g){if(200!==g)throw new c.Error("XgUIGrid select sync fail",B);return a.jqxGrid({source:d.createUIAdapter(f,"xgGrid")}),N[0]&&"function"==typeof N[0]?N[0](b,e,g):void 0}),a;if("xgUpdate"===t&&f.parent)return f.parent.update([f.getId()],N[0]),a;if("xgInitOption"===t)return a.data("xg-init-option");if("xgBindOption"===t)return a.data("xg-bind-option");if("blocksize"===t){if(1===arguments.length)return a.data("xg-option-blocksize");if(arguments.length>1)return"string"==typeof arguments[1]?L=parseInt(arguments[1],10):"number"==typeof arguments[1]&&(L=arguments[1]),a.data("xg-option-blocksize",L)}if("pagenum"===t){if(1===arguments.length)return a.data("xg-option-pagenum");if(arguments.length>1)return"string"==typeof arguments[1]?L=parseInt(arguments[1],10):"number"==typeof arguments[1]&&(L=arguments[1]),aa=a.jqxGrid("pagesize"),a.data("xg-option-virtualmode")&&f.parent.getDataAdapter().setParams({START:(L-1)*aa,PAGESIZE:aa}),a.data("xg-option-pagenum",L)}if("totalRecords"===t)return a.data("xg-option-virtualmode")?a.data("xg-option-totalrecords")||0:f.getRowCount();if("getDataSet"===t)return f.parent;if("getDataTable"===t)return f}return b.fn.jqxGrid.apply(this,arguments)},e={},e=function(){var a,c;return a=Array.prototype.slice.call(arguments,0,1)[0],c=Array.prototype.slice.call(arguments,1,arguments.length)[0],b(a).xgGrid(c)},b(document).ready(function(){var a,c,d,e;for(c=b("[data-xg-grid]"),d=c.length,e=[];d--;)a=b(c[d]),e.push(a.data("xg-option")?a.xgGrid(a.data("xg-option")):void 0);return e}),XgPlatform.XgLogger.info(function(){return B+" : load end"}),e})}).call(this);