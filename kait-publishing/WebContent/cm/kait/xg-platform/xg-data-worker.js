(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l;e=!1,a=/\"column\"\:(\[.*?\])\}\,\"body/gi,c=/(\{\"\@crud\"\:[\s\S]*\})(?:\,\{|\]\}\}\])/gi,b=/\"messages\"\:(\{[\s\S]*?\})\}\}/gi,j=/\<sp\:header\>(.*?)\<\/sp\:header\>/gi,l=/(\<sp\:row[\s\S]*\<\/sp\:row\>)/gi,k=/(\<sp\:messages[\s\S]*\<\/sp\:messages\>)/gi,h=function(a){var b,c,e;b||(b=new XMLHttpRequest),e=a.URL,e.indexOf("?")>-1?e.length!==e.indexOf("?")+1&&(e+="&"):e+="?",a.params&&(e+=a.params+"&"),e+="SP-IO="+a.dataType,void 0!==a.SOCD&&null!==a.SOCD&&(e+="&SP-SOCD="+a.SOCD),a.params&&(e+="&SP-PARAM="+encodeURIComponent(a.params)),e+="&_="+(new Date).getTime(),c=null,b.frRowCount=0,b.frSeenBytes=0,b.frOverData=null,b.frDataType=a.dataType,b.frDataTableID=a.dtIDs,b.frProcSize=1024*a.unitSize,b.onreadystatechange=function(){return 3!==b.readyState||c?4===b.readyState?(clearInterval(c),d(b)):void 0:c=setInterval(function(){return d(b)},100)},b.open("GET",e,a.async),b.setRequestHeader("Content-Type","text/plain"),b.send()},i=function(a){var b,c,e,f,g,h,i,j;if(b||(b=new XMLHttpRequest),j=a.URL,f=a.headers.length,h=null,b.frRowCount=0,b.frSeenBytes=0,b.frOverData=null,b.frDataType=a.dataType,b.frDataTableID=a.dtIDs,b.frProcSize=1024*a.unitSize,b.onreadystatechange=function(){return 3!==b.readyState||h?4===b.readyState?(clearInterval(h),d(b)):void 0:h=setInterval(function(){return d(b)},100)},b.open("POST",j,a.async),b.setRequestHeader("SP-IO",a.dataType),b.setRequestHeader("SP-SOCD",a.SOCD),b.setRequestHeader("SP-PARAM",encodeURIComponent(a.params)),f>0)for(e=c=0,i=f-1;i>=0?i>=c:c>=i;e=i>=0?++c:--c)g=a.headers[e],b.setRequestHeader(g.name,g.value);b.setRequestHeader("Content-Type","text/plain;charset=UTF-8"),b.send(a.packet)},d=function(a){switch(a.readyState){case a.LOADING:if(200===a.status){if(a.frProcSize<204800&&(a.frProcSize=204800),a.responseText.length-a.frSeenBytes<a.frProcSize)break;"JSON"===a.frDataType?f(a,!1):g(a,!1),a.frProcSize<2048e3&&(a.frProcSize*=2,a.frProcSize>2048e3&&(a.frProcSize=2048e3))}else postMessage({step:"error",dtIDs:a.frDataTableID,code:a.status,result:a.statusText});break;case a.DONE:a.frSeenBytes!==a.responseText.length&&200===a.status&&("JSON"===a.frDataType?f(a,!0):g(a,!0)),close()}},f=function(d,f){var g,h,i,j,k,l,m;for(i=d.responseText.slice(d.frSeenBytes),d.frSeenBytes=d.responseText.length,null!==d.frOverData&&(i=d.frOverData+i),e||(j=a.exec(i),j&&(m=j.index+(j[1].length+1),g='{"column":'+j[1]+"}",postMessage({step:"column",dtIDs:d.frDataTableID,code:d.status,result:g}),e=!0)),l=[];null!==(j=c.exec(i));)l.push(j[1]),m=j.index+(j[1].length+1);m&&(d.frOverData=i.slice(m)),k='{"row":['+l.join(",")+"]}",postMessage({step:"row",dtIDs:d.frDataTableID,code:d.status,result:k}),f&&(j=b.exec(i),j&&(h='{"messages":'+j[1]+"}",postMessage({step:"message",dtIDs:d.frDataTableID,code:d.status,result:h})))},g=function(a,b){var c,d,f,g,h,i,m;for(f=a.responseText.slice(a.frSeenBytes),a.frSeenBytes=a.responseText.length,null!==a.frOverData&&(f=a.frOverData+f),e||(g=j.exec(f),g&&(m=g.index+(g[1].length+1),c=g[1],postMessage({step:"column",dtIDs:a.frDataTableID,code:a.status,result:c}),e=!0)),i=[];null!==(g=l.exec(f));)i.push(g[1]),m=g.index+g[1].length;m&&(a.frOverData=f.slice(m)),h=""+i.join(""),postMessage({step:"row",dtIDs:a.frDataTableID,code:a.status,result:h}),b&&(g=k.exec(f),g&&(d=g[1],postMessage({step:"message",dtIDs:a.frDataTableID,code:a.status,result:d})))},this.onmessage=function(a){var b;return a.data instanceof Object?"select"===a.data.step&&(b=a.data.requestType.toUpperCase(),"POST"===b?i({async:a.data.async,dataType:a.data.dataType,dtIDs:a.data.dtIDs,unitSize:a.data.unitSize,params:a.data.params||null,headers:a.data.headers,SOCD:a.data.SOCD,URL:a.data.URL}):"GET"===b&&h({async:a.data.async,dataType:a.data.dataType,dtIDs:a.data.dtIDs,unitSize:a.data.unitSize,params:a.data.params||null,SOCD:a.data.SOCD,URL:a.data.URL})):(postMessage({step:"error",dtIDs:a.data.dtIDs,code:-1,result:"Can't use First-Row. Because invalid parameter."}),close()),this}}).call(this);