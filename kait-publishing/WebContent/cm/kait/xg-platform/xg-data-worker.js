(function(){"use strict";var a,b,c,d,e,f=/\"column\"\:(\[.*?\])\}\,\"body/gi,g=/\"messages\"\:(\{[\s\S]*?\})\}\}/gi,h=/(\{\"\@crud\"\:[\s\S]*\})(?:\,\{|\]\}\}\])/gi,i=/\<sp\:header\>(.*?)\<\/sp\:header\>/gi,j=/(\<sp\:messages[\s\S]*\<\/sp\:messages\>)/gi,k=/(\<sp\:row[\s\S]*\<\/sp\:row\>)/gi,l=!1;d=function(b){var c=new XMLHttpRequest,d=null,e=b.URL;e.indexOf("?")>-1?e.length!==e.indexOf("?")+1&&(e+="&"):e+="?",b.params&&(e+=b.params+"&"),e+="SP-IO="+b.dataType,void 0!==b.SOCD&&null!==b.SOCD&&(e+="&SP-SOCD="+b.SOCD),b.params&&(e+="&SP-PARAM="+encodeURIComponent(b.params)),e+="&_="+(new Date).getTime(),c.frRowCount=0,c.frSeenBytes=0,c.frOverData=null,c.frDataType=b.dataType,c.frDataTableID=b.dtIDs,c.frProcSize=1024*b.unitSize,c.onreadystatechange=function(){return 3!==c.readyState||d?4===c.readyState?(clearInterval(d),a(c)):void 0:d=setInterval(function(){return a(c)},100)},c.open("GET",e,b.async),c.setRequestHeader("Content-Type","text/plain"),c.send()},e=function(b){var c,d,e=new XMLHttpRequest,f=b.headers.length,g=null,h=b.URL;if(e.frRowCount=0,e.frSeenBytes=0,e.frOverData=null,e.frDataType=b.dataType,e.frDataTableID=b.dtIDs,e.frProcSize=1024*b.unitSize,e.onreadystatechange=function(){return 3!==e.readyState||g?4===e.readyState?(clearInterval(g),a(e)):void 0:g=setInterval(function(){return a(e)},100)},e.open("POST",h,b.async),e.setRequestHeader("SP-IO",b.dataType),e.setRequestHeader("SP-SOCD",b.SOCD),e.setRequestHeader("SP-PARAM",encodeURIComponent(b.params)),f>0)for(c=0;f>c;++c)d=b.headers[c],e.setRequestHeader(d.name,d.value);e.setRequestHeader("Content-Type","text/plain;charset=UTF-8"),e.send(b.packet)},a=function(a){switch(a.readyState){case a.LOADING:if(200===a.status){if(a.frProcSize<204800&&(a.frProcSize=204800),a.responseText.length-a.frSeenBytes<a.frProcSize)break;"JSON"===a.frDataType?b(a,!1):c(a,!1),a.frProcSize<2048e3&&(a.frProcSize*=2,a.frProcSize>2048e3&&(a.frProcSize=2048e3))}else postMessage({step:"error",dtIDs:a.frDataTableID,code:a.status,result:a.statusText});break;case a.DONE:a.frSeenBytes!==a.responseText.length&&200===a.status&&("JSON"===a.frDataType?b(a,!0):c(a,!0)),close()}},b=function(a,b){var c,d,e,i,j,k=a.responseText.slice(a.frSeenBytes),m=[];for(a.frSeenBytes=a.responseText.length,null!==a.frOverData&&(k=a.frOverData+k),l||(e=f.exec(k),e&&(j=e.index+(e[1].length+1),c='{"column":'+e[1]+"}",postMessage({step:"column",dtIDs:a.frDataTableID,code:a.status,result:c}),l=!0));null!==(e=h.exec(k));)m.push(e[1]),j=e.index+(e[1].length+1);j&&(a.frOverData=k.slice(j)),i='{"row":['+m.join(",")+"]}",postMessage({step:"row",dtIDs:a.frDataTableID,code:a.status,result:i}),b&&(e=g.exec(k),e&&(d='{"messages":'+e[1]+"}",postMessage({step:"message",dtIDs:a.frDataTableID,code:a.status,result:d})))},c=function(a,b){var c,d,e,f,g,h=a.responseText.slice(a.frSeenBytes),m=[];for(a.frSeenBytes=a.responseText.length,null!==a.frOverData&&(h=a.frOverData+h),l||(e=i.exec(h),e&&(g=e.index+(e[1].length+1),c=e[1],postMessage({step:"column",dtIDs:a.frDataTableID,code:a.status,result:c}),l=!0));null!==(e=k.exec(h));)m.push(e[1]),g=e.index+e[1].length;g&&(a.frOverData=h.slice(g)),f=""+m.join(""),postMessage({step:"row",dtIDs:a.frDataTableID,code:a.status,result:f}),b&&(e=j.exec(h),e&&(d=e[1],postMessage({step:"message",dtIDs:a.frDataTableID,code:a.status,result:d})))},this.onmessage=function(a){var b;return a.data instanceof Object?"select"===a.data.step&&(b=a.data.requestType.toUpperCase(),"POST"===b?e({async:a.data.async,dataType:a.data.dataType,dtIDs:a.data.dtIDs,unitSize:a.data.unitSize,params:a.data.params||null,headers:a.data.headers,SOCD:a.data.SOCD,URL:a.data.URL}):"GET"===b&&d({async:a.data.async,dataType:a.data.dataType,dtIDs:a.data.dtIDs,unitSize:a.data.unitSize,params:a.data.params||null,SOCD:a.data.SOCD,URL:a.data.URL})):(postMessage({step:"error",dtIDs:a.data.dtIDs,code:-1,result:"Can't use First-Row. Because invalid parameter."}),close()),this}}).call(this);